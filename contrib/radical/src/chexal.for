c  Notes on this file          8 September 1993          John Chun
c
c  This source file contains all subroutines needed for Chexal-Lellouch void
c    correlation calculations.
c  These subroutines are unmodified, untouched versions as received from
c    Vishwas of Altos Engineering in June 1993 and inspected by Davood of
c    S. Levy Inc.
c  This file is a merger of four original source files:
c    hpt.for, PROP.FOR, S1.FOR, S22.FOR.
c  All copyright of this file belongs to Electric Power Research Institute.


c$NOFLOATCALLS
c$STORAGE:2
CBLOCKDATA FOR PROPERTY ROUTINES
      BLOCKDATA MPS_DUMMY_NAME            !Changed by MPS, gave BLOCKDATA a dummy name so __UNNAMED_DATA isn't linked to twice (Error LNK1669)
C
      REAL*8 R,TC,VC,PCC,TO,COEFFA,COEFFB,COEFFC,COEFFD,COEFFE,
     & COEFFF,COEFFG,COEFFH,VVG,TVG,A,B,ATK,ACP,AST,CF1,CF2,CF3,
     & CG1,CG2,CG3,CT,CNL,CNV,AK,TAIR,FMUA,RGA
C
      REAL*4  PS11, TS11, RF11, RG11, FU11, FG11, TU11, ST11, TT11,
     &        PS12, TS12, RF12, RG12, FU12, FG12, TU12, ST12, TT12,
     &       PS113,TS113,RF113,RG113,RP113,FU113,FG113,TU113,ST113
C
      COMMON/CRIT/R,TC,VC,PCC,TO
      COMMON/STAB/ COEFFA(30),COEFFB(30),COEFFC(30),COEFFD(30),
     & COEFFE(30),COEFFF(30),COEFFG(30),COEFFH(27)
      COMMON/VGOT/VVG(59),TVG(59)
      COMMON/DVIS/A(4),B(5,6)
      COMMON/TRM/ATK(4)
      COMMON/SPT/ACP(5)
      COMMON/SIG/AST(5)
      COMMON/HLC/CF1(9),CF2(9),CF3(9)
      COMMON/HVC/CG1(12),CG2(9),CG3(7)
      COMMON/TLC/CT(2,4)
      COMMON/VLC/CNL(3,5)
      COMMON/VVC/CNV(4,3)
      COMMON/PTC/AK(9)
      COMMON/PAIR/TAIR(19),FMUA(19),RGA(19)
      COMMON/F11P/PS11(21),TS11(21),RF11(21),RG11(21),FU11(18),FG11(18),
     & TU11(18),ST11(3),TT11(3)
      COMMON/F12P/PS12(24),TS12(24),RF12(24),RG12(24),FU12(16),FG12(16),
     & TU12(16),ST12(6),TT12(6)
      COMMON/F113P/PS113(30),TS113(30),RF113(23),RG113(23),RP113(23),
     & FU113(19),FG113(19),TU113(19),ST113(19)
C - FREON 22 CONSTANTS
      DATA R,TC,VC,PCC,TO/96.1467,369.17,.001906,4977600.,200./
C - STMTAB CONSTANTS
      DATA  COEFFA                  / .22082221D+04, .65000000D+03
     &, .69573391D+03, .60464261D+01, .70000000D+01, .18552680D+00
     &,-.19513682D+00,-.52279952D+00, .91148958D-01, .61843682D-01
     &,-.50625849D+00, .72595720D+00, .14585694D+02, .12404319D+03
     &, .55592942D+03, .20000000D+01,-.74133440D-06, .73324823D-06
     &, .26548914D-04, .91349306D-04, .15679922D-02, .25032530D-01
     &, .30706919D+00, .36241343D+01, .44960616D+02, .17926732D+03
     &, .45000000D+03, .55000000D+03,-.98736888D-22, .19301230D-19/
      DATA  COEFFB                  / .30041189D-17,-.42113669D-15
     &,-.32893178D-14,-.11734466D-11, .11244476D-07,-.78419653D-05
     &, .81536841D-02, .69519265D+01, .25000000D+03, .20575548D-23
     &,-.64272696D-21, .12704366D-18,-.96976163D-16, .83370000D-13
     &,-.64251564D-10, .44797322D-07,-.28104756D-04, .17490541D-01
     &, .33953897D+01, .43010158D+03, .54927377D+03,-.18444779D-19
     &, .92756543D-17,-.95470656D-15,-.29004677D-12, .35353292D-10
     &, .39936598D-08,-.99567313D-06,-.59157992D-03, .78143274D+00/
      DATA  COEFFC                  / .55000000D+03, .21848036D+03
     &,-.14722587D-21, .66553573D-19, .47725605D-17,-.53349163D-14
     &, .27455505D-12,-.18335302D-10,-.31160333D-06,-.11956354D-03
     &, .98512754D+00, .25000000D+03, .47000000D+03, .55000000D+03
     &, .73857180D-22, .33225506D-19, .30075575D-18,-.73898651D-15
     &,-.70679233D-14, .90114201D-11, .58149642D-09, .86712981D-07
     &, .30734203D-04, .21762691D-01, .25000000D+03,-.78459129D-25
     &,-.33608032D-23, .85819792D-20, .25729365D-18,-.31591904D-15/
      DATA  COEFFD                  / .60506309D-13, .13684599D-10
     &, .15587770D-07, .81264440D-05, .17002639D-01, .45000000D+03
     &, .55000000D+03, .94743147D-18, .24971478D-16,-.38302588D-14
     &, .44979672D-12,-.51337380D-10, .49178986D-08, .48326895D-05
     &, .12399614D-02, .12798551D+01, .54927377D+03, .25000000D+03
     &, .12945371D-21,-.65873139D-19,-.13817574D-17, .62520106D-14
     &, .17548001D-12, .23202424D-09, .36145967D-06, .12506461D-03
     &, .10150974D+01, .21848036D+03, .45000000D+03, .55000000D+03/
      DATA  COEFFE                  /-.21134438D-20, .15327038D-18
     &, .69217855D-16,-.18345822D-14,-.66417458D-12, .14589563D-10
     &, .59598410D-08, .45575915D-06, .12325099D-02, .74969797D+00
     &, .25000000D+03, .50084539D-23,-.15659070D-21,-.46099119D-18
     &, .49239634D-17, .16250351D-13,-.74068320D-12, .10479899D-08
     &,-.85546496D-06, .14285709D-02, .36753405D+00, .17000000D+01
     &, .19000000D+01,-.11085077D+05,-.15994587D+05, .91407688D+04
     &,-.18796109D+03, .15699797D+03,-.20213342D+03,-.48650176D+02/
      DATA  COEFFF                  / .15040455D+03,-.19050547D+03
     &, .11199490D+04, .15000000D+01,-.14863585D+06,-.13414819D+06
     &, .62379937D+05, .29474498D+05,-.18907586D+05,-.57858876D+03
     &, .35122466D+04,-.12340833D+04,-.68928827D+02, .12036836D+04
     &, .30000000D+01, .13000000D+04, .70848990D+01, .16507788D+02
     &, .52122736D+03,-.11682947D-01,-.12001588D+00, .20411991D+01
     &, .12340954D-04, .13555136D-03,-.15099319D-03, .30000000D+01
     &, .18000000D+01, .23822091D+02, .18776649D+03, .33080504D+03/
      DATA  COEFFG                  /-.32141408D+01, .42449101D+03
     &, .16400835D+04, .18746657D+02, .63978878D+02, .20719841D+04
     &, .13000000D+04, .18000000D+01,-.64369800D-05, .96418803D-02
     &, .38879248D+01, .11034060D-05, .47225001D-03,-.94113600D+01
     &, .69416973D-05,-.60892120D-02, .10951922D+01, .13000000D+04
     &, .18000000D+01,-.33101208D-03, .21661916D+01, .53500291D+03
     &,-.77236618D-03, .36753650D+00,-.25450121D+03, .25249707D-02
     &,-.16427106D+01, .61477766D+03,      0.0,           0.0     /
      DATA  COEFFH                  /      0.0, 0.0, 0.0, 0.0, 0.0
     &, 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0, .90000000D+03
     &, .14000000D+01,-.15478259D-04, .19351556D-01, .24698909D+01
     &, .23329644D-04, .11493791D-02,-.13139208D+02, .58860219D-05
     &,-.12592899D-01, .55101160D+01/
C - DATA FROM VGOFT2
      DATA VVG /   1.139,   0.8955,   0.7118,   0.5715,   0.4631,
     &            0.3785,   0.3118,   0.2589,   0.2164,   0.1822,
     &            0.1543,   0.1314,   0.1125,  0.09688,  0.08379,
     &           0.07280,  0.06796,  0.06351,  0.05941,  0.05563,
     &           0.05213,  0.04890,  0.04591,  0.04313,  0.04055,
     &           0.03816,  0.03593,  0.03386,  0.03193,  0.03013,
     &           0.02844,  0.02687,  0.02540,  0.02402,  0.02272,
     &           0.02151,  0.02037,  0.01930,  0.01829,  0.01734,
     &           0.01645,  0.01560,  0.01481,  0.01405,  0.01334,
     &           0.01266,  0.01202,  0.01142,  0.01029, 0.009278,
     &          0.008353, 0.007508, 0.006731, 0.006011, 0.005337,
     &          0.004696, 0.004070, 0.003423, 0.001906/
      DATA TVG / 200,   204,   208,   212,   216,   220,   224,   228,
     &           232,   236,   240,   244,   248,   252,   256,   260,
     &           262,   264,   266,   268,   270,   272,   274,   276,
     &           278,   280,   282,   284,   286,   288,   290,   292,
     &           294,   296,   298,   300,   302,   304,   306,   308,
     &           310,   312,   314,   316,   318,   320,   322,   324,
     &           328,   332,   336,   340,   344,   348,   352,   356,
     &           360,   364,   369.17/
C - DATA FROM DYVIS
      DATA A / .0181583D0,.0177624D0,.0105287D0,-.0036744D0/
      DATA B / .501938D0,.235622D0,-.274637D0,.145831D0,
     &-.0270448D0,.162888D0,.789393D0,-.743539D0,.263129D0,-.0253093D0,
     &-.130356D0,.673665D0,-.959456D0,.347247D0,-.0267758D0,.907919D0,
     &1.207552D0,-.687343D0,.213486D0,-.0822904D0,-.551119D0,.0670665D0,
     &-.497089D0,.100754D0,.0602253D0,.146543D0,-.084337D0,.195286D0,
     &-.032932D0,-.0202595D0/
C - DATA FROM THERM
      DATA ATK / 1.02811D-2,2.99621D-2,1.56146D-2,-4.22464D-3/
C - DATA FROM SPHET
      DATA ACP/.167774D1,-.871946D-2,.405183D-4,-.802066D-7,.602554D-10/
C - DATA FROM CIGMA
      DATA AST/ 0.D0, 1.121404688D-3,-5.75280518D-6,1.28627465D-8,
     & -1.14971929D-11/
C - DATA FROM HFP
      DATA CF1 / .6970887859D2,.3337529994D2,.2318240735D1,
     &.1840599513D0,-.5245502284D-2,
     &.2878007027D-2,.1753652324D-2,-.4334859629D-3,.3325699282D-4/
      DATA CF2 / .8408618802D6,.3637413208D6,-.4634506669D6,
     &.1130306339D6,-.4350217298D3,-.3898988188D4,.6697399434D3,
     &-.4730726377D2,.1265125057D1/
      DATA CF3 / .9060030436D3,-.1426813520D2,.1522233257D1,
     &-.6973992961D0,.1743091663D0,-.2319717696D-1,.1694019149D-2,
     &-.64547721710D-4,.1003003098D-5/
C - DATA FROM HGP
      DATA CG1 / .1105836875D4,.1436943768D2,.8018288621D0,
     &.1617232913D-1,-.1501147505D-2,4*0.D0,-.1237675562D-4,
     &.3004773304D-5,-.2062390734D-6/
      DATA CG2 / -.2234264997D7,.1231247634D7,-.1978847871D6,
     &.1859988044D2,-.2765701318D1,.1036033878D4,-.2143423131D3,
     &.1690507762D2,-.4864322134D0/
      DATA CG3 / .9059978254D3,.5561957539D1,.3434189609D1,
     &-.6406390628D0,.5918579484D-1,-.2725378570D-2,.5006336938D-4/
C - DATA FROM TPHL
      DATA CT(1,1),CT(1,2),CT(1,3),CT(1,4)
     &/.3276275552D02,.9763617000D0,.1857226027D-3,
     &-.4682674330D-6/
      DATA CT(2,1),CT(2,2),CT(2,3),CT(2,4)
     &/.3360880214D-2,-.5595281760D-4,.1618595991D-6,
     &-.1180204381D-9/
C - DATA FROM VPHL
      DATA CNL/-4.117961750D0,-.4816067020D-5
     &,-.1820625039D-8,-0.3811294543D-3,.7744786733D-7
     &,.1440785930D-10,.4308265942D-5,-.6988467605D-9
     &,-.2082170753D-13,-.9160120130D-8,.1916720525D-11
     &,-.3603625114D-16,.8017924673D-11,-.1760288590D-14
     &,.7407124321D-19/
C - DATA FROM VPHV
      DATA CNV/-0.1403086182D4,.3817195017D0,-.6449501159D-4
     &,0.7823817858D-8,0.1802594763D1,-0.5394444747D-3
     &,.8437637660D-7,-0.1053834646D-10,
     &-0.2097279215D-3,0.1855203702D-6,-0.2713755001D-10
     &,0.3629590764D-14/
C - DATA FREOM PSOFT
	DATA AK/-7.691234564,-2.608023696D1,-1.681706546D2
     &  ,6.423285504D1,-1.189646225D2,4.167117320D0,2.097506760D1
     &  ,1.0D9,6.0D0/
C - AIR/WATER DATA
      DATA TAIR/-20.,.0,20.,40.,60.,80.,100.,120.,140.,160.,180.,200.,
     & 220.,240.,260.,280.,300.,500.,800./
      DATA FMUA/.036,.037,.041,.043,.045,.048,.048,.049,.049,.050,.050,
     & .052,.053,.054,.055,.056,.057,.067,.081/
      DATA RGA/.0902,.0863,.0827,.0794,.0763,.0735,.0709,.0684,.0662,
     & .0640,.0620,.0601,.0584,.0567,.0551,.0536,.0522,.0413,.0315/
C - FREON 11 DATA
      DATA PS11/10.876,13.345,16.233,19.587,23.456,27.890,32.943,38.668,
     &45.123,52.364,60.451,79.414,102.52,130.31,163.35,202.24,247.63,
     &300.21,429.96,598.40,639.50/
      DATA TS11/60,70,80,90,100,110,120,130,140,150,160,180,200,220,240,
     &260,280,300,340,380,388.4/
      DATA RF11/93.539,92.722,91.895,91.057,90.209,89.349,88.476,87.589,
     &86.689,85.772,84.839,82.916,80.908,78.796,76.558,74.163,71.565,
     &68.696,61.591,48.614,34.570/
      DATA RG11/3.6151,2.9882,2.4892,2.0888,1.7645,1.4999,1.2824,1.1024,
     &0.95232,0.82650,0.72037,0.55357,0.43108,0.33938,0.26952,0.21538,
     &0.17274,0.13860,0.087394,0.046570,0.028927/
      DATA FU11/1.113,1.000,0.908,0.824,0.755,0.696,0.644,0.603,0.571,
     &0.530,0.488,0.448,0.399,0.345,0.295,0.231,0.159,0.081/
      DATA FG11/0.0238,0.0265,0.0284,0.0297,0.0307,0.0314,0.0319,0.0324,
     &0.0331,0.0340,0.0354,0.0373,0.0399,0.0434,0.048,0.053,0.060,0.081/
      DATA TU11/60,80,100,120,140,160,180,200,220,240,260,280,300,320,
     &340,360,380,388.4/
      DATA ST11/1362,1048,0/
      DATA TT11/60,120,388.4/
C - FREON 12 DATA
      DATA PS12/9.3076,11.999,15.267,19.189,23.849,29.335,35.736,43.148,
     &51.667,61.394,72.433,84.888,98.870,114.49,131.86,151.11,172.35,
     &195.71,221.32,279.82,349.00,430.09,524.43,596.9/
      DATA TS12/-40,-30,-20,-10,0,10,20,30,40,50,60,70,80,90,100,110,
     &120,130,140,160,180,200,220,233.6/
      DATA RF12/94.661,93.690,92.699,91.689,90.659,89.606,88.529,87.426,
     &86.296,85.136,83.944,82.717,81.450,80.142,78.785,77.376,75.906,
     &74.367,72.748,69.209,65.102,60.026,52.670,34.84/
      DATA RG12/3.8750,3.0585,2.4429,1.9727,1.6089,1.3241,1.0988,0.9188,
     &.77357,.65537,.55839,.47818,.41134,.35529,.30794,.26769,.23326,
     &.20364,.17799,.13604,.10330,.076728,.053140,.02870/
      DATA FU12/0.990,0.866,0.767,0.687,0.620,0.564,0.517,0.477,0.441,
     &0.409,0.370,0.329,0.273,0.200,0.149,0.075/
      DATA FG12/0.0235,0.0249,0.0265,0.0279,0.0291,0.0301,0.0311,0.0324,
     &0.0339,0.0359,0.0384,0.0417,0.0458,0.051,0.060,0.075/
      DATA TU12/-40,-20,0,20,40,60,80,100,120,140,160,180,200,220,230,
     & 233.6/
      DATA ST12/1216,809,603,507,316,0/
      DATA TT12/-40,40,80,100,140,233.6/
C - FREON 113 DATA
      DATA PS113/4.419,5.566,6.940,8.574,10.50,12.75,15.36,18.38,21.83,
     &25.76,30.21,35.23,40.86,47.14,54.12,61.85,70.38,79.75,90.01,
     &101.2,113.4,141.1,173.5,211.2,254.5,304.4,361.6,427.2,463.7,491.3/
      DATA TS113/60,70,80,90,100,110,120,130,140,150,160,170,180,190,200
     &,210,220,230,240,250,260,280,300,320,340,360,380,400,410,417/
      DATA RF113/106,92.75,89,86,83,82,80,78.5,77,75.3,74,72.5,71,69.3,
     &67.9,66.5,69,63.5,62,60.6,58.72,49.96,41.90/
      DATA RP113/0.3,20,40,60,80,100,120,140,160,180,200,220,240,260,
     &280,300,320,340,360,380,400,463.7,491.3/
      DATA RG113/.01215,.615,1.2,1.8,2.45,2.93,3.45,4,4.6,5.35,5.9,6.5,
     &7.2,7.7,8.4,9.6,11,12.4,13.85,15.4,17.76,21.83,29.07/
      DATA FU113/1.187,1.607,1.396,1.224,1.083,0.966,0.866,0.783,0.712,
     &0.651,0.596,0.547,0.500,0.453,0.404,0.348,0.282,0.205,0.072/
      DATA FG113/.023,.024,.025,.026,.0271,.0281,.0288,.0295,.0301,
     &.0307,.0315,.0325,.0337,.035,.037,.040,.043,.045,.072/
      DATA ST113/1357,1268,1150,1090,1000,923,846,756,670,590,510,433,
     &351,280,205,137,70,5,1/
      DATA TU113/60,80,100,120,140,160,180,200,220,240,260,280,300,320,
     &340,360,380,400,417/
C
      END
CPROP
      SUBROUTINE PROP
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      REAL*8 MF,MG
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TS,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TS,IER,IFL	!change by Yasu
      COMMON/TABSTM/ DUMMY(9),IR
C---- SUBROUTINE TO EVALUATE THERMAL PROPERTIES
      GOTO(1,1,2,3,4,5,6)IFL
C---- REFRIGERANT 11
2     CONTINUE
      CALL FRE11
      GOTO 88
3     CONTINUE
C---- REFRIGERANT 12
      CALL FRE12
      GOTO 88
4     CONTINUE
C---- REFRIGERANT 22
      CALL FRE22
      GOTO 88
5     CONTINUE
C---- REFRIGERANT 113
      CALL FRE113
      GOTO 88
6     CONTINUE
C---- REFRIGERANT 114
      CALL FRE114
      GOTO 88
C---- STEAM-WATER AND AIR-WATER
1     CONTINUE
      PC=3208.2
      IF(TMP.EQ.0.0)THEN
      IF(P.LE.2208.)THEN
      CALL STMTAB(1,P,0.D0)
      TS = DUMMY(2)
      CALL STMTAB(4,P,0.D0)
      IF(IR.NE.0)IER=4
      RF=1./DUMMY(4)
      RG=1./DUMMY(7)
      ELSE IF((P.GT.2208.).AND.(P.LE.3208.2))THEN
C---- FOR P > 2208 CALCULATE SATURATED LIQUID AND VAPOR DENSITY
C---- FROM GE REPORT KAPL-M-6734 (NOV, 1967), TSAT FROM PSOFT ROUTINE
        Y=(3208.5-P)**.35
        RF=19.17+(1.875-1.14D-4*P)*Y
        RG=20.2-(1.148+4.6D-5*P)*Y
C---- GET FIRST ESTIMATE FOR SATURATION TEMPERATURE FROM EQN IN KAPL REPORT
        TRY=620.994+.055386*P-3.516D-6*P*P-226805./(P+768.85)
        ER=1.D-8
C---- NEWTON RAPHSON ITERATIVE SOLUTION
        II=1
10      CALL PSOFT(TRY,PS,DER)
        IF(DABS(PS-P).GE.ER)THEN
          D=PS-P
          TRY=TRY-D/DER
          II=II+1
          IF(II.LE.100)GOTO 10
C         WRITE(*,2)
C2        FORMAT('  Problem in Tsat iteration ')
          IER=4
        ENDIF
        TS=TRY
      ELSE
        IER=4
      ENDIF
C---- CALCULATE TRANSPORT PROPERTIES
      SIG=CIGMA(TS)
      MF=DYVIS(TS,RF)
      MG=-.84/(P+70.)+.0391+7.63*P/1.D6
      IF (P.LE.1500) GO TO 77
      MG=3.33/(P-800.)+0.01361-3.*P/1.D6
      MG=MG*RG
 77   CONTINUE
      ELSE
C---- AIR-WATER PROPERTIES
      CALL STMTAB(1,P,0.D0)
      TS = DUMMY(2)
      CALL STMTAB(2,TMP,0.D0)
      RF=1./DUMMY(4)
      SIG=CIGMA(TMP)
      MF=DYVIS(TMP,RF)
      CALL AIRP(TMP,P,RG,MG)
      ENDIF
88    CONTINUE
      RETURN
      END
CDYVIS
      FUNCTION DYVIS(TT,RH1)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C---- SATURATED OR SUBCOOLED LIQUID DYNAMIC VISCOSITY
C---- (LBM/FT-HR) AS A FUNCTION OF TEMPERATURE (DEGF)
C---- AND DENSITY (LBM/FT3) - RETRAN02 PROP FIT
      COMMON/DVIS/ A(4),B(5,6)
      T=((5./9.)*(TT-32.))+273.
      RHO=RH1*1.601846D1
      TSTR=647.27
      PSTR=317.763
      U11=A(1)
      RT=TSTR/T
      PT=RHO/PSTR
      DO 10 J=2,4
      U11=U11+(A(J)*RT**(J-1))
10    CONTINUE
      U11=1./U11
      U12=DSQRT(1./RT)
      U1=U11*U12
      RS=RT-1.
      PS=PT-1.
      U21=B(1,1)+PS*(B(2,1)+PS*(B(3,1)+PS*(B(4,1)+PS*B(5,1))))
      DO 15 J=2,6
      UAD=B(1,J)+PS*(B(2,J)+PS*(B(3,J)+PS*(B(4,J)+PS*B(5,J))))
      U21=U21+UAD*RS**(J-1)
15    CONTINUE
      U2=DEXP(PT*U21)
      DYVIS=U1*U2
      DYVIS=DYVIS*2.419088D-3
      RETURN
      END
CTHERM
      FUNCTION THERM(TT,RH1)
C---- SATURATED OR SUBCOOLED LIQUID THERMAL CONDUCTIVITY (BTU/HR-FT-DEGF) 
C---- AS A FUNCTION OF TEMPERATURE (DEGF) AND DENSITY (LBM/FT3) 
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/TRM/ ATK(4)
      T=((5./9.)*(TT-32.))+273.
      RHO=RH1*1.601846D1
      TSTR=647.3
      B1=-3.9707D-1
      B2=4.00302D-1
      B3=1.06
      BL1=-1.71587D-1
      BL2=2.39219
      PSTR=317.7
      D1=7.01309D-2
      D2=1.1852D-2
      D3=1.69937D-3
      D4=-1.02
      C1=6.42857D-1
      C2=-4.11717
      C3=-6.17937
      C4=3.08976D-3
      C5=8.22994D-2
      C6=1.00932D1
      Z1=(T/TSTR)**0.5
      Z2=0.
      RT=T/TSTR
      DO 10 J=1,4
      Z2=Z2+ATK(J)*RT**(J-1)
   10 CONTINUE
      Z3=Z2*Z1
      Y1=B1+B2*(RHO/PSTR)
      Y2=B3*DEXP(BL1*(BL2+(RHO/PSTR))**2)
      Y3=Y1+Y2
      X1=(D1*(1./RT)**10+D2)*((RHO/PSTR)**1.8)*(DEXP(C1*(1.-(RHO/PSTR)**
     12.8)))
      DLTS=DABS(RT-1.0)+C4
      Q=2.0+C5*(DLTS**(-0.6))
      R=Q+1.0
      IF(RT.LT.1.D0)GO TO 15
      S=DLTS**(-1)
      GO TO 20
   15 S=C6*(DLTS**(-0.6))
   20 X2=D3*S*((RHO/PSTR)**Q)*DEXP((Q/R)*(1.-((RHO/PSTR)**R)))
      X3=D4*DEXP(C2*(RT**1.5)+C3*((PSTR/RHO)**5))
      X4=X1+X2+X3
      THERM=Z3+Y3+X4
      THERM=THERM*0.577789
      RETURN
      END
CCPF
      FUNCTION SPHET(TT)
C---- SATURATED LIQUID SPECIFIC HEAT (BTU/LBM-DEGF) AS A FUNCTION 
C---- TEMPERATURE (DEGF) - THIS FUNCTION IS A POLYNOMIAL CURVE TO 
C---- FIT 1967 ASME STEAM TABLE DATA BETWEEN 200 DEGF AND 600 DEGF.
C---- IF INPUT TEMP. GREATER THAN 600 DEGF, SPECIFIC HEAT CALCULATED 
C---- FOR 600 DEGF.
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/SPT/ ACP(5)
      T=TT
      IF(T.GT.600.D0)T=600.
      SPHET=ACP(1)+T*(ACP(2)+T*(ACP(3)+T*(ACP(4)+T*ACP(5))))
      RETURN
      END
CSIGMA
      FUNCTION CIGMA(TT)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C---- SATURATED LIQUID SURFACE TENSION (LBF/FT) AS A
C---- FUNCTION OF TEMPERATURE (DEGF) - RETRANO2 PROP FIT
      COMMON /SIG/ AST(5)
      T=((5./9.)*(TT-32.))+273.
      TK=647.3
      D=1.160936807D-1
      B=.83
      S1=(D*(TK-T)**2) / (1+B*(TK-T))
      S2=0.
      DO 10 J=2,5
      S2=S2+AST(J)*(TK-T)**J
10    CONTINUE
      CIGMA=S1+S2
      CIGMA=CIGMA*6.852292D-5
      RETURN
      END
CAIRP
      SUBROUTINE AIRP(TMP,P,RG,FMG)
C---- AIR PROPERTIES AT LOW PRESSURES
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/PAIR/TAIR(19),FMUA(19),RGA(19)
      IF(TMP.LT.TAIR(1))THEN
      FMG = FMUA(1)
      RG = RGA(1)
      GO TO 50
      ENDIF
      IF(TMP.GT.TAIR(19))THEN
      FMG = FMUA(19)
      RG = RGA(19)
      GO TO 50
      ENDIF
      DO 30 NN = 1,19
      IF(TMP.LT.TAIR(NN))GO TO 35
30    CONTINUE
35    CONTINUE
      RATO = (TMP-TAIR(NN-1))/(TAIR(NN)-TAIR(NN-1))
      FMG = FMUA(NN-1) + RATO * (FMUA(NN) - FMUA(NN-1))
      RG = RGA(NN-1) + RATO * (RGA(NN) - RGA(NN-1))
50    CONTINUE    
C---- CORRECT DENSITY FOR PRESSURE  
      RG = RG * P/14.7
      RETURN
      END
CSTMTAB
C-----------------------------------------------------------------------
C     SUBROUTINE FOR THE THERMODYNAMIC PROPERTIES OF STEAM AND WATER
C       BASED ON KEENAN AND KEYES STEAM TABLES  2/23/67  M.E.AUGHEY
C-----------------------------------------------------------------------
C     USE OF SUBROUTINE STMTAB (NI,XI,YI)
C  1. MAINLINE PROGRAM MUST HAVE DIMENSION AND COMMON STATEMENTS
C     IN AGREEMENT WITH STMTAB
C      I.E.   DIMENSION SATLIQ(3),STEAM(3)
C             COMMON/TABSTM/PRESS,TEMP,QUAL,SATLIQ,STEAM,IER
C  2. TERMINOLOGY
C      NAME        PROPERTY                 SYMBOL      UNITS
C      PRESS       PRESSURE                 P OR PSAT - PSIA
C      TEMP        TEMPERATURE              T OR TSAT - DEG.F
C      QUAL        QUALITY                  X         - FRACTION
C      SATLIQ(1)   SAT.LIQUID SPEC.VOLUME   VF        - FT3/LB
C      SATLIQ(2)   SAT.LIQUID ENTHALPY      HF        - BTU/LB
C      SATLIQ(3)   SAT.LIQUID ENTROPY       SF        - BTU/LB-DEG.F
C      STEAM(1)    VAPOR SPECIFIC VOLUME    V OR VG   - FT3/LB
C      STEAM(2)    VAPOR ENTHALPY           H OR HG   - BTU/LB
C      STEAM(3)    VAPOR ENTROPY            S OR SG   - BTU/LB-DEG.F
C      IER         ERROR FLAG, SET TO 4 IF PROPERTIES OUT OF RANGE
C  3. NI IS AN INDEX WHICH INDICATES TO THE SUBROUTINE THE PROPERTIES
C     SUPPLIED AS ARGUMENTS AND THE PROPERTIES DESIRED AS ANSWERS
C      EX.  CALL STMTAB (1,X,0.) RETURNS TSAT,VF,HF AND SF
C                                WITH PSAT AS ARGUMENT
C           CALL STMTAB (2,X,0.) RETURNS PSAT,VF,HF AND SF
C                                WITH TSAT AS ARGUMENT
C           CALL STMTAB (3,X,0.) RETURNS PSAT,TSAT,VF AND SF
C                                WITH HF AS ARGUMENT
C           CALL STMTAB (4,X,0.) RETURNS VF,VG,HF,HG,SF AND SG
C                                WITH PSAT AS ARGUMENT
C           CALL STMTAB (5,X,0.) RETURNS PSAT,VF,VG,HF,HG,SF AND SG
C                                WITH TSAT AS ARGUMENT
C           CALL STMTAB (6,X,0.) RETURNS PSAT,TSAT,VF,VG,HG,SF AND SG
C                                WITH HF AS ARGUMENT
C           CALL STMTAB (7,X,Y)  RETURNS V,H,S AND X=1.0
C                                WITH P AND T AS ARGUMENTS
C           CALL STMTAB (8,X,Y)  RETURNS T,V,S AND X
C                                WITH P AND H AS ARGUMENTS
C           CALL STMTAB (9,X,Y)  RETURNS T,V,H AND X
C                                WITH P AND S AS ARGUMENTS
C           CALL STMTAB (10,X,Y) RETURNS P,T,V AND X
C                                WITH H AND S AS ARGUMENTS
C           CALL STMTAB (11,X,Y) RETURNS V,H,S AND X=1.0
C                                WITH P AS ARGUMENT AT CONSTANT T
C  4. LIMITS - SATURATION LIMITED TO MAXIMUMS OF 2208 PSIA, 650 F AND
C              695.7 BTU/LB
C              SUPERHEAT LIMITED TO SPECIFIC VOLUME ABOVE .1603 FT3/LB
C  5. ACCURACY - WITHIN ROUNDING ERROR OF KEENAN AND KEYES VALUES
C  6. MEMORY SPACE REQUIRED - APPROXIMATELY 1100 WORDS TOTAL
C----------------------------------------------------------------------
      SUBROUTINE STMTAB (NI,XI,YI)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/STAB/ COEFFA(30),COEFFB(30),COEFFC(30),
     & COEFFD(30),COEFFE(30),COEFFF(30),COEFFG(30),COEFFH(27)
      DIMENSION COEFFT(237)
C
      EQUIVALENCE (COEFFA(1),COEFFT(1)),(COEFFB(1),COEFFT(31)),
     &            (COEFFC(1),COEFFT(61)),(COEFFD(1),COEFFT(91)),
     &            (COEFFE(1),COEFFT(121)),(COEFFF(1),COEFFT(151)),
     &            (COEFFG(1),COEFFT(181)),(COEFFH(1),COEFFT(211))
C
      COMMON/TABSTM/ PRESS,TEMP,QUAL,SATLIQ(3),STEAM(3),IER
       IER = 0
       IF(NI.LT.7 .OR. NI.GT. 9) GO TO 110
       IF(XI.GT.0.) GO TO 110
       DO 100 J=1,3
       STEAM(J) = 0.
100    CONTINUE
             GOTO 740
110    CONTINUE
      N=NI
      X=XI
      Y=YI
      I=N-3
      LINK=0
      PRESS=X
      DELTA1=0.0
      ERROR1=0.0
      ERROR2=0.0
      IF (N-6) 120,120,150
120   IF (I) 140,140,130
130   LINK=1
      N=I
140   IF (X-COEFFT(N)) 160,160,730
150   N=I
160         GOTO (240,180,300,340,200,210,290,440),N
170   X=Z
      N=2
180   TEMP=X
            GOTO 300
190   PRESS=DEXP(Z)
            GOTO 260
200   II=2
      JJ=3
      TOLER=.005
            GOTO 220
210   II=3
      JJ=2
      TOLER=.000005
220   H=Y
      LINK=2
230   N=1
240   X=DLOG(PRESS)
      PLOG=X
            GOTO 300
250   TEMP=Z
260   X=TEMP
      J=1
      N=4
            GOTO 300
270   SATLIQ(J)=Z
      J=J+1
      N=N+1
      IF (J-3) 300,300,280
280   IF (LINK) 740,740,410
290   H=X
      S=Y
      X=S
300   I=23*N-19
      K=1
      IF (X-COEFFT(I)) 310,310,320
310   K=12
320   I=I+K
      ARG=X-COEFFT(I)
      Z=0.0
      DO 330 K=1,10
      I=I+1
330   Z=Z*ARG+COEFFT(I)
            GOTO (250,190,170,270,270,270,520),N
340   TEMP=Y
            GOTO 410
350   ERROR=H-STEAM(II)
      IF (DABS(ERROR)-TOLER) 740,360,360
360   IF (ERROR1) 370,390,370
370   ERROR1=ERROR1-ERROR
      IF (DABS(ERROR1)-TOLER) 400,400,380
380   SLOPE=DELTA1/ERROR1
390   DELTA1=SLOPE*ERROR
      ERROR1=ERROR
400   TEMP=TEMP+DELTA1
410   IF (PRESS-COEFFT(1)) 430,430,420
420   IF ((.00001178*PRESS+.09411)*PRESS+382.1-TEMP) 430,430,730
430   T=.55555556*TEMP+255.38223
      IF(T.LE.0) GO TO 730
      TLOG=DLOG(T)
      TAU=1.0/T
      COEFFT(222)=TAU*TAU*186210.06
      COEFFT(217)=DEXP(COEFFT(222)+7.8791476-TLOG)
      COEFFT(221)=162460.*TAU
      COEFFT(220)=126970.*TAU
      COEFFT(219)=DEXP(149.27765-23.*TLOG)
      COEFFT(212)=1.89-COEFFT(217)
      COEFFT(211)=82.546-COEFFT(221)
      COEFFT(210)=.21828*T-COEFFT(220)
      COEFFT(209)=COEFFT(219)-.0003635*T
      COEFFT(222)=(COEFFT(222)+COEFFT(222)+1.0)*COEFFT(217)
      COEFFT(217)=COEFFT(212)-COEFFT(222)
      COEFFT(214)=COEFFT(217)/COEFFT(212)
      COEFFT(216)=COEFFT(211)*COEFFT(214)+41.273-COEFFT(221)
      COEFFT(215)=COEFFT(210)*COEFFT(214)-.5*COEFFT(220)
      COEFFT(214)=COEFFT(209)*COEFFT(214)+1.8461538*COEFFT(219)
      COEFFT(221)=.50*COEFFT(211)-COEFFT(216)
      COEFFT(220)=.25*COEFFT(210)-COEFFT(215)
      COEFFT(219)=.076923077*COEFFT(209)-COEFFT(214)
      COEFFT(218)=(.0037299965*T+14.531813)*T+17806.513+472.24937*TLOG
      COEFFT(223)=-.0074599931*T-14.531813*TLOG+2.4524439+472.24937*TAU
440   P=.068046190*PRESS
      PLOG=DLOG(PRESS)
      COEFFT(213)=COEFFT(212)*TAU
      COEFFT(226)=COEFFT(213)*P
      COEFFT(225)=COEFFT(226)*COEFFT(226)
      COEFFT(224)=COEFFT(225)*COEFFT(225)
      COEFFT(224)=COEFFT(224)*COEFFT(224)*COEFFT(226)
      COEFFT(226)=COEFFT(226)*COEFFT(213)
      COEFFT(213)=P*TAU
      STEAM(1)=(((COEFFT(209)*COEFFT(224)+COEFFT(210))*COEFFT(225)+
     &COEFFT(211))*COEFFT(226)+COEFFT(212)+4.55504/COEFFT(213))
     &*.0160185
      STEAM(2)=((((COEFFT(214)*COEFFT(224)+COEFFT(215))*COEFFT(225)+
     &COEFFT(216))*COEFFT(226)+COEFFT(217))*P+COEFFT(218))*.04355685
      STEAM(3)=((((COEFFT(219)*COEFFT(224)+COEFFT(220))*COEFFT(225)+
     &COEFFT(221))*COEFFT(226)+COEFFT(222))*COEFFT(213)+COEFFT(223)
     &+4.55504*PLOG)*(-.02419825)
      QUAL=1.0
      I=LINK+1
            GOTO (740,740,450,350,450,560),I
450   X=STEAM(II)
      IF (H-X) 460,740,470
460   Y=SATLIQ(II)
      QUAL=(H-Y)/(X-Y)
      X=1.0-QUAL
      STEAM(1)=QUAL*STEAM(1)+X*SATLIQ(1)
      STEAM(JJ)=QUAL*STEAM(JJ)+X*SATLIQ(JJ)
      STEAM(II)=H
      IF (LINK-2) 740,740,570
470   I=(II-1)*11+154
      J=1
      X=PLOG
480   DO 490 K=209,219
      COEFFT(K)=COEFFT(I)
490   I=I+1
      X=X-COEFFT(209)
      Y=Y-COEFFT(210)
      COEFFT(209)=(COEFFT(211)*X+COEFFT(212))*X+COEFFT(213)
      COEFFT(210)=(COEFFT(214)*X+COEFFT(215))*X+COEFFT(216)
      COEFFT(211)=((COEFFT(217)*X+COEFFT(218))*X+COEFFT(219))*Y
      Z=COEFFT(211)+COEFFT(210)
      SLOPE=COEFFT(211)+Z
      Z=Z*Y+COEFFT(209)
            GOTO (500,540,640,650),J
500   LINK=3
      IF (Z-TEMP) 410,410,510
510   TEMP=Z
            GOTO 410
520   J=2
      I=227
      X=H
      IF (Z-H) 530,480,480
530   I=187
            GOTO 480
540   DPDS=SLOPE
      PRESS=DEXP(Z)
      PLOG=Z
      IF (I-227) 630,630,550
550   LINK=4
      II=2
      JJ=3
            GOTO 230
560   DH=H-STEAM(2)
      STEAM(3)=STEAM(3)+DH/(TEMP+459.69)
570   DS=S-STEAM(3)
      DELTA1=STEAM(3)-ERROR1
      IF (ERROR1) 580,600,580
580   IF (DABS(DELTA1)-.000005) 610,610,590
590   DPDS=(PLOG-PLOG1)/DELTA1
600   PLOG1=PLOG
      ERROR1=STEAM(3)
610   PRESS=PRESS*(1.0+DS*DPDS)
      IF (LINK-4) 620,620,660
620   IF (DABS(DS)-.000005) 740,230,230
630   LINK=5
      X=H
      Y=S
      I=198
      J=3
            GOTO 480
640   TEMP=Z
      DTDS=SLOPE
      X=PLOG
      Y=H
      I=165
      J=4
            GOTO 480
650   DTDH=SLOPE
            GOTO 410
660   TEMP=TEMP+DS*DTDS
      IF (DABS(DH)-.005) 720,670,670
670   DELTA2=DH-ERROR2
      IF (ERROR2) 680,700,680
680   IF (DABS(DELTA2)-.005) 710,710,690
690   DTDH=(TEMP1-TEMP)/DELTA2
700   TEMP1=TEMP
      ERROR2=DH
710   TEMP=TEMP+DH*DTDH
            GOTO 430
720   IF (DABS(DS)-.000005) 740,710,710
730   CONTINUE
      IER = 1
740   RETURN
      END
CHFP
      FUNCTION HFP(P)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C****      SATURATED LIQUID ENTHALPY (BTU/LBM) AS A FUNCTION OF
C****      PRESSURE (LBF/IN2) - RETRAN02 PROP FIT
      COMMON/HLC/ CF1(9),CF2(9),CF3(9)
      IF(P.GT.900)GO TO 15
      FLNP=DLOG(P)
      HFP=CF1(1)+CF1(2)*FLNP
      DO 10 J=3,9
      HFP=HFP+CF1(J)*FLNP**(J-1)
   10 CONTINUE
      RETURN
   15 CONTINUE
      IF(P.GT.2400)GO TO 25
      FLNP=DLOG(P)
      HFP=CF2(1)+CF2(2)*FLNP
      DO 20 J=3,9
      HFP=HFP+CF2(J)*FLNP**(J-1)
   20 CONTINUE
      RETURN
   25 CONTINUE
      PDIF=(3208.2-P)**.41
      HFP=CF3(1)+CF3(2)*PDIF
      DO 30 J=3,9
      HFP=HFP+CF3(J)*PDIF**(J-1)
   30 CONTINUE
      RETURN
      END
CHGP
      FUNCTION HGP(P)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C****      SATURATED VAPOR ENTHALPY (BTU/LBM) AS A FUNCTION OF
C****      PRESSURE (LBF/IN2) - RETRAN02 PROP FIT
      COMMON/HVC/ CG1(12),CG2(9),CG3(7)
      IF(P.GT.1200)GO TO 15
      FLNP=DLOG(P)
      HGP=CG1(1)+CG1(2)*FLNP
      DO 10 J=3,12
      HGP=HGP+CG1(J)*FLNP**(J-1)
   10 CONTINUE
      RETURN
   15 CONTINUE
      IF(P.GT.2600)GO TO 25
      FLNP=DLOG(P)
      HGP=CG2(1)+CG2(2)*FLNP
      DO 20 J=3,9
      HGP=HGP+CG2(J)*FLNP**(J-1)
   20 CONTINUE
      RETURN
   25 CONTINUE
      PDIF=(3208.2-P)**.41
      HGP=CG3(1)+CG3(2)*PDIF
      DO 30 J=3,7
      HGP=HGP+CG3(J)*PDIF**(J-1)
   30 CONTINUE
      RETURN
      END
CTPHL
      FUNCTION TPHL(P,H)
C****      SATURATED OR SUBCOOLED LIQUID TEMPERATURE (DEGF) AS A
C****      FUNCTION OF PRESSURE (LBF/IN2) AND ENTHALPY (BTU/LBM)
C****      - RETRAN02 PROP FIT
	IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/TLC/CT(2,4)
      DIMENSION C(2)
      DO 10 I=1,2
	C(I)=CT(I,1)+H*(CT(I,2)+H*(CT(I,3)+H*CT(I,4)))
   10	CONTINUE
	TPHL = C(1)+C(2)*P
      RETURN
      END
CVPHL
      FUNCTION VPHL(P,H)
C****    SATURATED OR SUBCOOLED SPECIFIC VOLUME (FT3/LBM) AS
C****    A FUNCTION OF PRESSURE (LBF/IN2) AND ENTHALPY
C****    (BTU/LBM) - RETRAN02 PROP FIT
	IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/VLC/CNL(3,5)
      DIMENSION CO(3)
	DO 10 J=1,3
	CO(J)=CNL(J,1)+H*(CNL(J,2)+H*(CNL(J,3)+H*(CNL(J,4)+H*CNL(J,5))))
   10	CONTINUE
	VFZ=CO(1)+P*(CO(2)+P*CO(3))
	VPHL = DEXP(VFZ)
      RETURN
      END
CVPHV
      FUNCTION VPHV(P,H)
C****    SATURATED OR SUPERHEATED SPECIFIC VOLUME (FT3/LBM)
C****    AS A FUNCTION OF PRESSURE (LBF/IN2) AND ENTHALPY
C****    (BTU/LBM) - RETRAN02 PROP FIT
	IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/VVC/CNV(4,3)
      DIMENSION CO(4)
	DO 10 J=1,4
	CO(J)=CNV(J,1)+H*(CNV(J,2)+H*CNV(J,3))
   10	CONTINUE
	VPHV = CO(1)/P+CO(2)+P*(CO(3)+P*CO(4))
       RETURN
       END
CPSOFT
	SUBROUTINE PSOFT(T,PS,DBETL)
C----	CALCULATES SATURATION PRESSURE AS A FUNCTION OF TEMPERATURE
C----	BASED ON ASME 1967 TABLES
C----	PS = SATURATION PRESSURE (PSIA)
C----	T = TEMPERATURE (DEGF)
C----	DBETL = DPS/DT
	IMPLICIT REAL*8(A-H,O-Z)
	COMMON/PTC/AK(9)
	THT=(T+459.67)/1165.14
	A1=0.0
	A2=0.0
        FHT=1.-THT
        A1=FHT*(AK(1)+FHT*(AK(2)+FHT*(AK(3)+FHT*(AK(4)+FHT*AK(5)))))
        A2=(AK(1)+FHT*(2.*AK(2)+FHT*(3.*AK(3)+FHT*(4.*AK(4)+5.*FHT*
     &  AK(5)))))
	DE1=THT*(1.+FHT*(AK(6)+AK(7)*FHT))
	DE2=AK(8)*FHT**2+AK(9)
	ARG=A1/DE1-FHT/DE2
	BETL=DEXP(ARG)
	DD1=1.+FHT*(AK(6)+FHT*AK(7))-THT*(AK(6)+2.*AK(7)*FHT)
	DD2=-2.*AK(8)*FHT
	DARG=-(A2*DE1+A1*DD1)/DE1**2+(DE2+FHT*DD2)/DE2**2
	DBETL=BETL*DARG*3209.111646/1165.14
	PS=BETL*3209.111646
	RETURN
	END
CFRE11
      SUBROUTINE FRE11
c  saturated properties of Freon 11
c  data from Table 1, Section 17, ASHRAE Handbook
c      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,IR,TSAT,IFL
      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT,IR,IFL	!change by Yasu
      DOUBLE PRECISION FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT
c  check range of pressure 10.8766<p<388.4 - critical pressure
      if((dp.lt.10.8766).or.(dp.gt.388.4))then
        ir=4
        goto 10
      endif
      tmp=0.0
      pc=388.4
      p=dp
      CALL F11(P,T,RRF,RRG,FMU,GMU,ST)
      tsat=t
      rf = rrf
      rg = rrg
      fmf = fmu
      fmg = gmu
      sg = st
10    continue  
      return
      end
CF11
      SUBROUTINE F11(P,T,RRF,RRG,FMU,GMU,ST)
      COMMON/F11P/PS11(21),TS11(21),RF11(21),RG11(21),FU11(18),FG11(18),
     & TU11(18),ST11(3),TT11(3)
C INTERPOLATE IN THE PRESSURE-VS-TEMPERATURE AND DENSITY TABLES
      IF(P.LE.PS11(1))THEN
      T=TS11(1)
      RRF=RF11(1)
      RRG=1./RG11(1)
      GOTO 100
      ENDIF
c  linear interpolation for temperature vs pressure
      DO 10 I=2,21
      IF(P.GT.PS11(I))GOTO 10
      PRATO=(P-PS11(I-1))/(PS11(I)-PS11(I-1))
      T=TS11(I-1)+(TS11(I)-TS11(I-1))*PRATO
c  linear interpolation for liquid density vs pressure
      RRF=RF11(i-1)+(RF11(I)-RF11(I-1))*PRATO
c  linear interpolation for vapor density vs pressure
      RRG=RG11(I-1)+(RG11(I)-RG11(I-1))*PRATO
      RRG=1./RRG
      GOTO 100
   10 CONTINUE
      T=TS11(21)
      RRF=RF11(21)
      RRG=1./RG11(21)
  100 CONTINUE
C INTERPOLATE IN VISCOSITY VERSUS TEMPERATURE TABLE
      IF(T.LE.TU11(1))THEN
      FMU=FU11(1)
      GMU=FG11(1)
      GOTO 200
      ENDIF
c  interpolation 1/temp vs liquid viscosity
      DO 20 I=2,18
      IF(T.GT.TU11(I))GOTO 20
      TRAT=(1./(T+460)-1./(TU11(I-1)+460))/(1./(TU11(I)+460)-
     & 1./(TU11(I-1)+460))
      FMU=FU11(I-1)+(FU11(I)-FU11(I-1))*TRAT
c sqrt interpolation for vapor viscosity versus temperature
      TRAS=(SQRT(T+460)-SQRT(TU11(I-1)+460))/(SQRT(TU11(I)+460)-
     & SQRT(TU11(I-1)+460))
      GMU=FG11(I-1)+(FG11(I)-FG11(I-1))*TRAS
      GOTO 200
   20 CONTINUE
      FMU=FU11(18)
      GMU=FG11(18)
  200 CONTINUE
C INTERPOLATE IN SURFACE TENSION VERSUS TEMPERATURE TABLE
      IF(T.LE.TT11(1))THEN
      ST=ST11(1)
      GOTO 300
      ENDIF
c  linear interpolation for surface tension versus temperature
      DO 30 I=2,3
      IF(T.GT.TT11(I))GOTO 30
      SIG=ST11(I-1)+(ST11(I)-ST11(I-1))*((T-TT11(I-1))/(TT11(I)-
     & TT11(I-1)))
      GOTO 300
   30 CONTINUE
      SIG=ST11(3)
  300 CONTINUE
      ST=SIG/1.E6
      RETURN
      END
CFRE12
      SUBROUTINE FRE12
c  saturated properties of Freon 12
c  data from Table 2, Section 17, ASHRAE Handbook
c      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,IR,TSAT,IFL
      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT,IR,IFL	!change by Yasu
      DOUBLE PRECISION FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT
c  check range of pressure  9.3076<p<233.6 - critical pressure
      if((dp.lt.9.3076).or.(dp.gt.233.6))then
        ir=4
        goto 10
      endif
      tmp=0.0
      pc=233.6
      p=dp
      CALL F12(P,T,RRF,RRG,FMU,GMU,ST)
      tsat=t
      rf = rrf
      rg = rrg
      fmf = fmu
      fmg = gmu
      sg = st
10    continue  
      return
      end
CF12
      SUBROUTINE F12(P,T,RRF,RRG,FMU,GMU,ST)
      COMMON/F12P/PS12(24),TS12(24),RF12(24),RG12(24),FU12(16),FG12(16),
     & TU12(16),ST12(6),TT12(6)
C INTERPOLATE IN PRESSURE-VS-TEMP AND DENSITY TABLE
      IF(P.LE.PS12(1))THEN
      T=TS12(1)
      RRF=RF12(1)
      RRG=1./RG12(1)
      GOTO 100
      ENDIF
c  linear interpolation for temperature vs pressure
      DO 10 I=2,24
      IF(P.GT.PS12(I))GOTO 10
      PRATO=(P-PS12(I-1))/(PS12(I)-PS12(I-1))
      T=TS12(I-1)+(TS12(I)-TS12(I-1))*PRATO
c  linear interpolation for liquid density vs pressure
      RRF=RF12(i-1)+(RF12(I)-RF12(I-1))*PRATO
c  linear interpolation for vapor density vs pressure
      RRG=RG12(I-1)+(RG12(I)-RG12(I-1))*PRATO
      RRG=1./RRG
      GOTO 100
   10 CONTINUE
      T=TS12(24)
      RRF=RF12(24)
      RRG=1./RG12(24)
  100 CONTINUE
C INTERPOLATE IN VISCOSITY-VS-TEMPERATURE TABLE
      IF(T.LE.TU12(1))THEN
      FMU=FU12(1)
      GMU=FG12(1)
      GOTO 200
      ENDIF
c  interpolation 1/temp vs liquid viscosity
      DO 20 I=2,16
      IF(T.GT.TU12(I))GOTO 20
      TRAT=(1./(T+460)-1./(TU12(I-1)+460))/(1./(TU12(I)+460)-
     & 1./(TU12(I-1)+460))
      FMU=FU12(I-1)+(FU12(I)-FU12(I-1))*TRAT
c sqrt interpolation for vapor viscosity versus temperature
      TRAS=(SQRT(T+460)-SQRT(TU12(I-1)+460))/(SQRT(TU12(I)+460)-
     & SQRT(TU12(I-1)+460))
      GMU=FG12(I-1)+(FG12(I)-FG12(I-1))*TRAS
      GOTO 200
   20 CONTINUE
      FMU=FU12(16)
      GMU=FG12(16)
  200 CONTINUE
C INTERPOLATE IN SURFACE TENSION VERSUS TEMPERATURE TABLE
      IF(T.LE.TT12(1))THEN
      ST=ST12(1)
      GOTO 300
      ENDIF
c  linear interpolation for surface tension versus temperature
      DO 30 I=2,6
      IF(T.GT.TT12(I))GOTO 30
      SIG=ST12(I-1)+(ST12(I)-ST12(I-1))*((T-TT12(I-1))/(TT12(I)-
     & TT12(I-1)))
      GOTO 300
   30 CONTINUE
      SIG=ST12(6)
  300 CONTINUE
      ST=SIG/1.E6
      RETURN
      END
CFREON 22 PROPERTIES
      SUBROUTINE FRE22
C THIS SUBROUTINE EVALUATES THE SATURATED LIQUID AND VAPOR PROPERTIES
C OF FREON22
      IMPLICIT REAL*8 (A-H,O-Z)
      DOUBLE PRECISION MF,MG,DP,PC,RF,RG,SIG,TMP
c      COMMON/PRO/MF,MG,DP,PC,RF,RG,SIG,TMP,IR,TSAT,IFL
      COMMON/PRO/MF,MG,DP,PC,RF,RG,SIG,TMP,IR,IFL,TSAT	!change by Yasu
      COMMON /CRIT/R,TC,VC,PCC,TO
      PC=PCC/6.89478D+3 
C Check pressure range
      IF((DP.LT.2.426).OR.(DP.GT.721.905))THEN
      IR=4
      GOTO 10
      ENDIF
C pressure    PRES   (Pa)
      PRES=DP*6.89478D+3
C temperature in K
      TK=TSOFP2(PRES)
C density in KG/M3     
      RHOF=RFOFT2(TK)
      RHOG=1./VGOFT2(TK)
C liquid surface tension  (N/M)
      SIGSI=CIGMA2(TK)
C viscosity in N-s/m2
      XMUF=DYVIS2(TK,1)  
      XMUG=DYVIS2(TK,2)
C ---- CONVERSION    ---- 
C       viscosity   MF,MG  (LBM/FT-H)   
C       density     RF,RG  (LBM/FT3)   
C       temperature TSAT   (degF)
      MF=XMUF*2419.0934
      MG=XMUG*2419.0934
      RF=RHOF*.062428
      RG=RHOG*.062428
      TSAT=(9.*TK/5.)-459.67
      SIG=SIGSI*0.06852178
10    CONTINUE
      RETURN
      END
CRFOFT2
       FUNCTION RFOFT2(TI)
C     Calculates saturated liquid density for Refrigerant 22
C     Given T, returns RFOFT2 saturated liquid density
C     Units: T-fK, RFOFT2-kg/cu.m
C     Reference: THERMODYNAMIC PROPERTIES IN SI, W.C.Reynolds, Department
C                of Mechanical Enineering, Stanford University
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 D(5)
      COMMON /CRIT/R,TC,VC,PC,TO
      DATA D / 5.24766060D+02, 8.75161285D+02, 5.88662575D+02,
     &        -3.57093464D+02, 3.27951374D+02/
C USE FIT FROM 200K TO 359K, INTERPOLATE ABOVE
      T=TI
      IF(TI.GT.359.)T=359.
      X=(1.-T/TC)**(1./3.)
      RFOFT2=D(1)+X*(D(2)+X*(D(3)+X*(D(4)+X*D(5))))
      IF(TI.GT.359.)THEN
        RC=1./VC  
        RFOFT2=RC+(RFOFT2-RC)*(TC-TI)/10.17
      ENDIF
      RETURN
      END
CVGOFT2
      FUNCTION VGOFT2(TV)
C Function linear interpolates for Vg (cu.m/kg) given T (fK)
      IMPLICIT REAL*8 (A-H,O-Z)
      COMMON/VGOT/ VVG(59), TVG(59)
C Determine table location
      DO 100 N=2,59
         IF(TV.LE.TVG(N)) GO TO 120
  100 CONTINUE
C Linear interpolate for Vg
  120 CONTINUE
      VGOFT2 =VVG(N-1)+(TV-TVG(N-1))/(TVG(N)-TVG(N-1))*(VVG(N)-VVG(N-1))
      RETURN
      END
CPSOFT2
      SUBROUTINE PSOFT2(TI,P,DPDT)
C Calculates saturation pressure from temperature for Refrigerant 22
C Given T, returns P saturated pressure and the derivative dPsat/dTsat
C Units: T-fK, P-Pa
C Reference: THERMODYNAMIC PROPERTIES IN SI, W.C.Reynolds, Department
C            of Mechanical Enineering, Stanford University
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 F(5)
      COMMON /CRIT/R,TC,VC,PC,TO
      DATA F,Y / 7.1554148092D+01, -4.8189575050D+03, -7.8610312200,
     .           9.0806824483D-03,  4.4574670300D-01,  381.17/
      T = TI
      PE = F(1)+F(2)/T+F(3)*DLOG(T)+F(4)*T+F(5)*(Y-T)/T*DLOG(Y-T)
      P = DEXP(PE)
      DPDT = P*(-F(2)/T**2+F(3)/T+F(4)-F(5)*((1.0/T+(Y-T)/T**2)*
     &       DLOG(Y-T)+1.0/T))
      RETURN
      END
CTSOFP2
      FUNCTION TSOFP2(P)
C Calculates saturation temperature from pressure for Refrigerant 22
C Units: T-fK, P-Pa
      IMPLICIT REAL*8 (A-H,O-Z)
      COMMON /CRIT/ R,TC,VC,PC,TO
C ESTIMATE TEMPERATURE
      T=248.0
C SPECIFIED P - START WITH THE TRIAL T
      KTR=0
      ERR=1.0D-6*P
  10  IF (T.GT.TC)  T=TC-0.001D0
      CALL PSOFT2(T,PX,DPDT)
      DP=P-PX
      IF (DABS(DP).LT.ERR)GOTO 20
      IF (KTR.GT.500)GOTO 80
      DT=DP/DPDT
      DTA=DABS(DT)
      DTM=0.1D0*T
      IF (DTA.GT.DTM) DT=DT*DTM/DTA
      T=T+DT
      KTR=KTR+1
      GO TO 10
  20  TSOFP2 = T
      RETURN
  80  CONTINUE
      TSOFP2=T-DT/2.
C     WRITE (*,90)  DABS(P-PX)/PX
      RETURN
  90  FORMAT (' NOT CONVERGED for Tsat given P, Error(%)=',E13.6)
      RETURN
      END
CCIGMA2
      FUNCTION CIGMA2(TEMP)
C----- Surface Tension for Freon 22
C      Temp  : Temperature, Deg K 
C      Cigma : Surface Tension, N/m
C      Range : -100 deg C to 85 deg C - lttle short, but use up to crit point
	IMPLICIT REAL*8 (A-H,O-Z)
        COMMON /CRIT/ R,TC,VC,PC,TO
C	Deg K to Deg C
	TT = TEMP - 273					
	IF(TEMP.GT.358.)TT=85.	
        Z1 =  0.11727584D-01
	Z2 = -0.15729266D-03
	Z3 =  0.17736567D-06
	Z4 =  0.14165497D-08 
	Z5 =  0.29655176D-11
	CIGMA2 = Z1+TT*(Z2+TT*(Z3+TT*(Z4+Z5*TT)))
        IF(TEMP.GT.358.)CIGMA2=CIGMA2*(TC-TEMP)/(TC-358.)
	RETURN
	END
CDYVIS2
      FUNCTION DYVIS2(TI,IR)
C Calculates viscosity for Refrigerant 22 form temperature
C Units: T-fK, u-N sec/sq.m (Pa-s)
C Input IR denotes region, IR=1 - saturated liquid
C                          IR=2 - saturated vapor
C                          IR=3 - superheated vapor
      IMPLICIT REAl*8 (A-H,O-Z)
      COMMON /CRIT/ R, TC, VC, PC, TO
      T = TI
C CALCULATE VISCOSITY BASED ON REGION
C SATURATED LIQUID-RANGE 170<T<359, LITTLE SHORT BUT USE UP TO CRIT POINT
      IF(IR.EQ.1)THEN
         IF(T.LE.310.)THEN
            U = DEXP(-3.39554 + 532.855/T)* 1.0D-3
         ELSE
            IF(TI.GT.359.)T=359.
            U = (-1.65108 + T*(1.24147E-2 - 2.09286E-5*T)) * 1.0D-3
            IF(TI.GT.359.)U=30.5D-6+(U-30.5D-6)*(TC-TI)/(TC-359.)
         ENDIF
C SUPERATED VAPOR-RANGE 250<T<500, NOT USED IN SAT PROP SUBROUTINE
      ELSE IF(IR.EQ.3) THEN
         U = DSQRT(T)/(0.61943+(239.551-7605.74/T)/T) * 1.0D-6
C SATURATED VAPOR-RANGE 230<T<350, LITTLE SHORT BUT USE 200 TO Tcrit
      ELSE
         IF(TI.GT.359.)T=359.
         U=(-0.031501+T*(4.20115D-4-T*(1.50840D-6-2.02506D-9*T)))*1.0D-3
         IF(TI.GT.359.)U=30.5D-6+(U-30.5D-6)*(TC-TI)/(TC-359.)
      ENDIF
      DYVIS2 = U
      RETURN
      END
CFRE113
      SUBROUTINE FRE113
c  saturated properties of Freon 113
c      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,IR,TSAT,IFL
      COMMON /PRO/FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT,IR,IFL	!change by Yasu
      DOUBLE PRECISION FMF,FMG,DP,PC,RF,RG,SG,TMP,TSAT
c  check range of pressure  4.42<p<491.3 - critical pressure
      if((dp.lt.4.419).or.(dp.gt.491.3))then
        ir=4
        goto 10
      endif
      tmp=0.0
      pc=491.3
      p=dp
      CALL F113(P,T,RRF,RRG,FMU,GMU,ST)
      tsat=t
      rf = rrf
      rg = rrg
      fmf = fmu
      fmg = gmu
      sg = st
10    continue  
      return
      end
CF113
      SUBROUTINE F113(P,T,FFR,FFG,FMU,GMU,ST)
      COMMON/F113P/PS113(30),TS113(30),RF113(23),RG113(23),RP113(23),
     & FU113(19),FG113(19),TU113(19),ST113(19)
C INTERPOLATE IN THE PRESSURE-VS-TEMPERATURE TABLE
      IF(P.LE.PS113(1))THEN
      T=TS113(1)
      GOTO 100
      ENDIF
c  linear interpolation for temperature versus pressure
      DO 10 I=2,30
      IF(P.GT.PS113(I))GOTO 10
      T=TS113(I-1)+(TS113(I)-TS113(I-1))*((P-PS113(I-1))/(PS113(I)-
     & PS113(I-1)))
      GOTO 100
   10 CONTINUE
      T=TS113(30)
  100 CONTINUE
C INTERPOLATE IN THE PRESSURE-VS-DENSITY TABLES
      IF(P.LE.RP113(1))THEN
      FFR=RF113(1)
      FFG=RG113(1)
      GOTO 200
      ENDIF
c  linear interpolation for liquid & vapor density vs pressure
      DO 20 I=2,23
      IF(P.GT.RP113(I))GOTO 20
      PRATO=(P-RP113(I-1))/(RP113(I)-RP113(I-1))
      FFR=RF113(I-1)+(RF113(I)-RF113(I-1))*PRATO
      FFG=RG113(I-1)+(RG113(I)-RG113(I-1))*PRATO
      GOTO 200
   20 CONTINUE
      FFR=RF113(23)
      FFG=RG113(23)
  200 CONTINUE
C INTERP[OLATE IN TEMPERATURE-VS-VISCOSITY & SURFACE TENSION TABLES
      IF(T.LE.TU113(1))THEN
      FMU=FU113(1)
      GMU=FG113(1)
      SIG=ST113(1)
      GOTO 300
      ENDIF
      DO 30 I=2,19
      IF(T.GT.TU113(I))GOTO 30
c  interpolation 1/temp vs liquid viscosity
      TRAT=(1./(T+460)-1./(TU113(I-1)+460))/(1./(TU113(I)+460)-
     & 1./(TU113(I-1)+460))
      FMU=FU113(I-1)+(FU113(I)-FU113(I-1))*TRAT
c  sqrt interpolation for vapor viscosity versus temperature
      TRAS=(SQRT(T+460)-SQRT(TU113(I-1)+460))/(SQRT(TU113(I)+460)-
     & SQRT(TU113(I-1)+460))
      GMU=FG113(I-1)+(FG113(I)-FG113(I-1))*TRAS
c  linear interpolation for surface tension versus temperature
      SIG=ST113(I-1)+(ST113(I)-ST113(I-1))*((T-TU113(I-1))/
     & (TU113(I)-TU113(I-1)))
      GOTO 300
   30 CONTINUE
      FMU=FU113(19)
      GMU=FG113(19)
      SIG=ST113(19)
  300 continue
      ST=SIG/1.E6
      RETURN
      END
CFREON 114 PROPERTIES
      SUBROUTINE FRE114
C
C     THIS SUBROUTINE EVALUATES THE PROPERTIES OF FREON114
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 MF,MG
c      COMMON/PRO/MF,MG,DP,PC,RF,RG,SIG,TMP,IR,TSAT,IFL
      COMMON/PRO/MF,MG,DP,PC,RF,RG,SIG,TMP,IR,IFL,TSAT	!change by Yasu
C
C	    check pressure range
C	      
      IF((DP.LT.2.9).OR.(DP.GT.217.56))THEN
      IR=4
      GOTO 10
      ENDIF
C
C     	    pressure in PA
C
      PRES=DP*6.89478D+3
C
C           temperature in DEGC
C
       TC=TSAFR4(PRES)
C
C    	    viscosity in POISEUILLE
C
      HL = HLSFR4 (PRES)
      FSLMUP = VILSF4 (TC)
      HV = HVSFR4 (PRES)
      FSVMUP = VIVSF4 (HV)
C
C     	    density in KG/M3
C
      ROLSFP=1.D0/VLSFR4(TC)
      ROVSFP=1.D0/VVFRE4(TC,PRES)
C
C                  ---- CONVERSION    ---- 
C
C           viscosity   MF,MG  (LBM/FT-H)   
C     	    pressure    DP,PC  (PSIA) 
C           density     RF,RG  (LBM/FT3)   
C	    liquid surface tension  (LBF/FT)
C	    temperature             (DEG F)
C
      MF=FSLMUP*2.419D+3
      MG=FSVMUP*2.419D+3
      PC=4.73D+2
      RF=ROLSFP*6.2428D-2
      RG=ROVSFP*6.2428D-2 
      TSAT=(9.*TC/5.)+3.2D+1
      SIG=1.222D-3-(TSAT*4.9D-6)
C
10    CONTINUE
      RETURN           
      END              
C
      FUNCTION HLSFR4(P)                                        
      IMPLICIT REAL*8 (A-H,O-Z)                                         
      DIMENSION PL(6)                                                   
      DATA N/6/                                                         
      DATA A1/0.4133123D6/,A2/0.1826198D5/,A3/0.3781517D4/,A4/0.1170076D
     14/,A5/0.4415662D3/,A6/0.2756665D3/                                
      DATA B1/0.4887192D6/,B2/0.4695109D5/,B3/0.1144824D5/,B4/0.4432578D
     14/,B5/0.201211D4/,B6/0.9245466D3/                                 
C     ****************************************************************  
C     * ENTHALPY OF A SATURATED LIQUID AS A FUNCTION OF PRESSURE     *  
C     *                      PRESSURE IN PASCAL                      *  
C     *                      ENTHALPIE IN J/KG                       *  
C     *            RANGE OF VALIDITY 0.2D5<=P<=15.D5                  
C     ****************************************************************  
      PP=P*1.D-5                                                        
      IF(PP.GT.1.3D0) GO TO 1                                           
      PA=1.1D0                                                          
      PB=1.5D0                                                          
      XP=(2.D0*PP-PB)/PA                                                
      CALL LEGEND(N,XP,PL)                                              
      HLSFR4=A1*PL(1)+A2*PL(2)-A3*PL(3)+A4*PL(4)-A5*PL(5)+A6*PL(6)      
      RETURN                                                            
    1 PA=14.D0                                                          
      PB=16.D0                                                          
      XP=(2.D0*PP-PB)/PA                                                
      CALL LEGEND(N,XP,PL)                                              
      HLSFR4=B1*PL(1)+B2*PL(2)-B3*PL(3)+B4*PL(4)-B5*PL(5)+B6*PL(6)      
      RETURN                                                            
      END
C
      FUNCTION HVSFR4(P)                                        
      IMPLICIT REAL*8(A-H,O-Z)                                          
      DIMENSION A(5),B(5),C(5)                                          
      DATA R/4.864044212D1/,BB/3.692556D-4/,TC/418.85D0/,XK/3.D0/       
      DATA A(2)/-6.410438047D1/,A(3)/5.7127611D-2/,A(4)/-4.0396093D-5/,A
     1(5)/1.047161726D-8/                                               
      DATA B(2)/5.224227243D-2/,B(3)/-1.610472767D-5/,B(4)/0.D0/,       
     1     B(5)/7.370311885D-11/                                        
      DATA C(2)/-1.763883807D2/,C(3)/2.74536742D-1/,C(4)/0.D0/,         
     1     C(5)/-6.645620158D-8/                                        
      DATA XK1/4.315038D5/,AA1/1.787104D2/,AA2/2.007546D0/,             
     1     AA3/1.720274D-3/,AA4/4.956332D-7/                            
C     ******************************************************************
C     * ENTHALPY OF A SATURATED VAPOR AS A FUNCTION OF PRESSURE        *
C     *                      PRESSURE IN PASCAL                        *
C     *                      ENTHALPIE IN J/KG                         *
C     *              RANGE OF VALIDITY 0.2D5<=P<=15.D5                  
C     ******************************************************************
C   CALCULATE THE  V                                                       
      T=TSAFR4(P)                                                       
      T=T+273.16D0                                                      
      VI=BB+R*T/P                                                       
      V=VI                                                              
      EX=DEXP(-XK*T/TC)                                                 
  11  S1=0.D0                                                           
      S2=0.D0                                                           
      DO 3 K=2,5                                                        
      K1=K+1                                                            
      S1=S1+(A(K)+T*B(K)+EX*C(K))/((V-BB)**K)                           
      S2=S2+(A(K)+T*B(K)+EX*C(K))*K/((V-BB)**K1)                        
  3   CONTINUE                                                          
      FV=R*T/(V-BB)+S1-P                                                
      FDV=-R*T/((V-BB)**2)-S2                                           
      VF=V-FV/FDV                                                       
      E1=VF-V                                                           
      IF(DABS(E1/V).LT.1.D-05) GO TO 10                                 
      V=VF                                                              
      GO TO 11                                                          
C   CALCULATE THE  H                                                       
 10   T2=T*T                                                            
      T3=T2*T                                                           
      T4=T3*T                                                           
      S3=0.D0                                                           
      DO 4 K=2,5                                                        
      K2=K-1                                                          
      S3=S3+(A(K)+C(K)*(1.D0+XK*T/TC)*EX)/(((V-BB)**K2)*K2)             
  4   CONTINUE                                                          
      H=XK1+AA1*T+AA2*T2/2.D0-AA3*T3/3.D0+AA4*T4/4.D0+P*V+S3            
      HVSFR4=H                                                          
      RETURN
      END
C			                                                                   
      FUNCTION TSAFR4(P)
      IMPLICIT REAL*8 (A-H,O-Z)
      DATA A1,A2,A3/8.753367D-1,3.451612D-2,5.339703D-4/
      DATA B1/1.067941D-3/
      DATA C1,C2,C3,C4,C5,C6/2.909992D1,2.755797D3,63.08676D-1,1.24434D-
     A3,7.814211D-1,4.2686D2/
C     *******************************************************
C     * SATURATION TEMPERATURE AS A FUNCTION OF PRESSURE    *
C     *                 P IN PASCAL                         *
C     *                 T IN DEGREES C                      *
C     *         RANGE OF VALIDITY 0.2D5<=P<=15.D5           *
C     *******************************************************
      PP=P*1.D-5
      DELT=A2*A2-4.D0*A3*(A1-PP)
      TT=-A2/B1
      IF(DELT.GT.0.D0) TT=(-A2+DSQRT(DELT))/B1
      TT=TT+2.7316D2
      IF(TT.GE.C6) TT=3.9316D2
    2 FT=C1-C2/TT-C3*DLOG10(TT)+C4*TT+C5*((C6-TT)/TT)*DLOG10(C6-TT)-DLOG
     B10(P)
      FPRT=C2/(TT*TT)-((C3+C5)/(TT*DLOG(10.D0)))+C4-(C5*C6/(TT*TT))
     1     *DLOG10(C6-TT)
      T=TT-(FT/FPRT)
      B=DABS((T-TT)/TT)
      TT=T
      IF(B.GE.1.D-5) GOTO 2
      TSAFR4=T-2.7316D2
      RETURN
      END
C			    
      SUBROUTINE LEGEND(N,X,PL)                                         
      IMPLICIT REAL*8 (A-H,O-Z)                                         
      DIMENSION PL(N)                                                   
C     *******************************************************                   
C     * CALCULATION OF COEFFICIENTS FOR LEGENDRE POLYNOMINAL*                   
C     *******************************************************                   
      PL(1)=1.D0                                                        
      IF (N.EQ.1) RETURN                                                
      PL(2)=X                                                           
      IF (N.EQ.2) RETURN                                                
      PL(3)=0.5D0*(3.D0*PL(2)*PL(2)-1.D0)                               
      IF(N.EQ.3) RETURN                                                 
      DO 3 K=4,N                                                        
      AK=DFLOAT(K)                                                      
    3 PL(K)=((2.D0*AK-3.D0)*PL(2)*PL(K-1)-(AK-2.D0)*PL(K-2))/(AK-1.D0)  
      RETURN                                                            
      END
C			    
      FUNCTION VILSF4(TT)                                               
      IMPLICIT REAL*8 (A-H,O-Z)                                         
C     ****************************************************************   
C     * VISCOSITY OF A SATURATED LIQUID AS A FUNCTION OF TEMPERATURE *     
C     *                 TT IN  DEG C                                 *  
C     *                 VIS IN POISEUILLE                            *  
C     ****************************************************************  
      T=TT+273.16D0                                                      
      VIL=-4.4636D0+1011.47D0/T                                         
      VILSF4=DEXP(VIL)*1.D-3                                            
      RETURN                                                            
      END
C			                                                                   
      FUNCTION VIVSF4(HV)                                       
      IMPLICIT REAL*8(A-H,O-Z)                                          
      DATA A1,A2,A3,A4,A5,A6,A7/1.880953873279271D3,2.000343318095014D-2
     B,8.857362414620422D-8,2.090503323724606D-13,2.774121123899015D-19,
     C1.962708706060367D-25,5.784679281230866D-32/                      
C     ************************************************************      
C     * VISCOSITY OF A SATURATED VAPOR AS A FUNCTION OF ENTHALPY *      
C     *                 HV IN J/KG                               *      
C     *                 VIS IN POISEUILLE                        *      
C     ************************************************************      
      H1=HV                                                             
      H2=H1*H1                                                          
      H3=H2*H1                                                            
      H4=H3*H1                                                          
      H5=H4*H1                                                          
      H6=H5*H1                                                          
      VIVSF4=(A1-A2*H1+A3*H2-A4*H3+A5*H4-A6*H5+A7*H6)*1.D-3             
      RETURN                                                            
      END
C			                                                                   
      FUNCTION VLSFR4(TT)                                               
      IMPLICIT REAL*8 (A-H,O-Z)                                         
      DATA A/581.790586D0/,B/979.4715868D0/,C/262.9913702D0/,           
     1   D/279.9520876D0/,E/17.93792369D0/,TC/418.85D0/                 
C     *********************************************************************
C     * SPECIFIC VOLUME OF A SATURATED LIQUID AS A FUNCTION OF TEMPERATURE*
C     *       SPECIFIC VOLUME IN M3/KG                                    *
C     *       LIQUID TEMPERATURE DEG C                                    *
C     *********************************************************************
      T=TT+273.16D0                                                      
      R1=1.D0-T/TC                                                      
      E1=1.D0/3.D0                                                      
      E2=1.D0/2.D0                                                      
      RAU=A+B*(R1**E1)+C*R1+D*(R1**E2)+E*R1*R1                          
      VLSFR4=1.D0/RAU                                                   
      RETURN                                                            
      END
C                                                               
      FUNCTION  VVFRE4(TT,P)
      IMPLICIT REAL*8 (A-H,O-Z)                                         
C     ******************************************************************
C     *   SPECIFIC VOLUME OF A SATURATED VAPOR AS A FUNCTION OF        *
C     *   TEMPERATURE AND PRESSURE                                     *
C     *          P IN PASCAL                                           *
C     *          TT IN DEGC                                            *
C     *          VVFRE4 IN M3/KG                                       *
C     ******************************************************************
      DIMENSION A(5),B(5),C(5)                                          
      DATA R/4.864044212D1/,BB/3.692556D-4/,TC/418.85D0/,XK/3.D0/       
      DATA A(2)/-6.410438047D1/,A(3)/5.7127611D-2/,A(4)/-4.0396093D-5/,A
     1(5)/1.047161726D-8/                                               
      DATA B(2)/5.224227243D-2/,B(3)/-1.610472767D-5/,B(4)/0.D0/,B(5)/7.
     1370311885D-11/                                                    
      DATA C(2)/-1.763883807D2/,C(3)/2.74536742D-1/,C(4)/0.D0/,         
     1     C(5)/-6.645620158D-8/
      T=TT+273.16D0                                                      
      EXX=DEXP(-XK*T/TC)                                                
      VI=BB+R*T/P                                                       
      V=VI                                                              
C  CALCULATE THE  FV  ET  DE  FPV                                           
  2   S1=0.D0                                                           
      S2=0.D0                                                           
      DO 1 I=2,5                                                        
      F1=(A(I)+B(I)*T+C(I)*EXX)/((V-BB)**I)                             
      F2=I*F1/(V-BB)                                                    
      S1=S1+F1                                                          
      S2=S2+F2                                                          
  1   CONTINUE                                                          
      FV=R*T/(V-BB)+S1-P                                                
      FPV=-R*T/((V-BB)**2)-S2                                           
      VV=V-FV/FPV                                                       
      EC=VV-V                                                           
      IF(DABS(EC/V).LT.1.D-5)GOTO 3                                  
      V=VV                                                              
      GOTO 2                                                          
  3   VVFRE4=V                                                          
      RETURN                                                            
      END



c     The following lines have been copied from file 's1.f'   930825 chun


c$NOFLOATCALLS
c$STORAGE:2
CPCCLV
C Carl Wohlforth 5/5/88   Modularize and drive from c program module voidcalc.
C        REVISED 11/30/87 TO ADD NEW STEAM PROPS
C        AND MAKE OTHER SMALL CHANGES/ADDITIONS
C------------- NEW DRIVER WRITTEN 11/20/86 BY J.S. HOROWITZ
C              REVISED 3/5/87 CHANGED IF STATEMENT ON LINE 1163
C    THIS PROGRAM COMBINES GLENN, GERRY1 & FRESCO (RFRESCO)
C***********************************************************************
C Begin CONVRT
C***********************************************************************
C
      SUBROUTINE CONVRT ![C]
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
cw    DOUBLE PRECISION JF,JG,MF,MG
      DOUBLE PRECISION MF,MG
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /MODEL/DH,WF,WG,ORT
C Convert setup parameters to British units
      DH = DDH
      IF (IUNIT.EQ.0) DH = DH / .3048
      DHM = DH * .3048
      DDH = DH
      P = PP
      IF (IUNIT.EQ.0) P = P * 145.
      PP = P
      PM = P / 145.
      TMP = TT
      IF (IUNIT.EQ.0.AND.TT.GT.0.0) TMP = 9. * TMP / 5. + 32.
      CALL PROP
      RETURN
      END
C End CONVRT
C***********************************************************************
C Begin VFJfJg
C***********************************************************************
C
      SUBROUTINE VFJfJg ![C]
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION JF,JG,MF,MG
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
      COMMON /GLENN/JF,JG,GVOID(2),GVJG(2),GCZ(2),GQUAL(2)
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /MODEL/DH,WF,WG,ORT
C Calculate Void Fractions given Jf and Jg
      IF (IUNIT.EQ.0) THEN
        JG = JG / .3048
        JF = JF / .3048
      ENDIF
      CALL GLENNS
      RETURN
      END
C End VJJfJg
C***********************************************************************
C Begin VFWfWg
C***********************************************************************
C
      SUBROUTINE VFWfWg ![C]
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION JF,JG,MF,MG
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
      COMMON /GLENN/JF,JG,GVOID(2),GVJG(2),GCZ(2),GQUAL(2)
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /MODEL/DH,WF,WG,ORT
C Calculate Void Fractions given Wf and Wg
      AREA = 0.7854 * DDH * DDH
      WGT = WG
      WFT = WF
      IF (IUNIT.EQ.1) GO TO 41
      WGT = WGT * 2.2046
      WFT = WFT * 2.2046
41    CONTINUE
      JF = WFT / RF / AREA
      JG = WGT / RG / AREA
      CALL GLENNS
      RETURN
      END
C End VJWfWg
C***********************************************************************
CGLENNS
      SUBROUTINE GLENNS
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JG,JF,KZ,JFSTAR
cw    LOGICAL D(23)
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
      COMMON /GLENN/XJF,XJG,GVOID(2),GVGJ(2),GCZ(2),GQUAL(2)
      COMMON /POL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & INDEX
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON/MODEL/DH,WF,WG,ORT
      DIMENSION CZV(2),VJV(2)
C
      IER=0
C  CHECK FOR NEGATIVE VAPOR FLOW WITH POSITIVE LIQUID FLOW
      IF((XJG.LT.0.).AND.(XJF.GE.0.))THEN
      IER=1
      GOTO 66
      ENDIF
C  CHECK FOR ZERO NEGATIVE J IN COUNTERCURRENT FLOW
      IF(((XJF*XJG).LT.0.).AND.(ABS(XJF).GE.XJG))THEN
      IER=1
      GOTO 66
      ENDIF
      IPAS = 1
      C3(2)=0.0
      FVGJ=1.0
      FRA=0.0
      JF=XJF
      JG=XJG
      IF(ORT.EQ.90.)THEN
        FRA=1.0
        IF(XJF.LT.0.0.AND.XJG.LT.0.0)THEN
          JF=DABS(XJF)
          JG=DABS(XJG)
          FVGJ=-1.0
        ENDIF
      ENDIF
      FPC=(PC-P)/PC
      C1=4.*PC/(P*FPC)
      RR=RF/RG
      VJ0=1.41*((RR-1.0)*SIG*32.17*32.17/(RR*RF))**0.25
      IF(RR.GE.18.)THEN
        C5=DSQRT(150./RR)
        C2=1.0
        IF(C5.LT.1.0)THEN
          ARG=C5/(1.-C5)
          IF(ARG.LT.170.)C2=1./(1.-DEXP(-ARG))
        ENDIF
      ELSE
        C2=0.4757*(DLOG(RR))**0.7
      ENDIF
      C11=1.
      if (DH.ne.0.0) C9=(0.3/DH)**.6    !950605 chun
      IF(C9.GE.1.)GOTO 10
      C10=C9/(1.-C9)
      if (DH.ne.0.0) C11=1./(1.-DEXP(-C10))   !950605 chun
10    CONTINUE
      R1=RF*JF*DH*3600./MF
      REG=RG*JG*DH*3600./MG
      RE=REG
      IF(R1.GE.REG.AND.REG.GT.0.0)RE=R1
      B1=1.0
      IF(RE.LT.0.0)B1=1.0D-10
      IF(DABS(RE/60000.).LT.170.)B1= 1./(1.+DEXP(-RE/60000.))
      B1=DMIN1(0.8D0,B1)
      E1=B1
      IF(REG.LT.0.0)E1=0.65
      KZ=B1+(1.-B1)/(RR**0.25)
      R=(1.+1.57/RR)/(1.-B1)
      IF(R1.LT.0.)GO TO 20
      C3(1)=0.0
      IF((R1/60000.).LT.170.)C3(1)=2.*DEXP(-R1/60000.)
      IF(C3(1).LT.0.5)C3(1)=0.5
      GO TO 30
20    CONTINUE
      FIRST=2.*DEXP((-R1/350000.)**.400)
      POWER=-(R1/50000.)*((.125)/(DH))**2.0
      SEC=0.0
      IF(POWER.LT.170.)SEC=-(1.75*(-R1)**.030)*DEXP(-POWER)
      C3(1)=FIRST+SEC+1.0*((0.125/DH)**.250)*(-R1)**0.001
      POW2=(1.0/(1.0+.05*(-R1/350000.)))**0.4 
      C3(1)=2.0*((C3(1)/2.0)**POW2)
      IF(JG.LT.0)GO TO 30
C---- COUNTERCURRENT FLOW
      CALL FRESCO(JF,JG,1,JFSTAR,DUMMY)
      TEMP=DABS(JF/JFSTAR)
      C3(2)=C3(1)
      C3(1)=C3(2)*(TEMP)+2.0*(1.-TEMP)*(1.-R1/60000.)
      IF(C3(1).GT.C3(2))C3(1)=C3(2)
30    CONTINUE
      CALL ITERAT(R1,IER)
C---- VERTICAL OR HORIZONTIAL FLOW
      IF(ORT.EQ.0.0.OR.ORT.EQ.90.)THEN
        DO 35 I=1,2
35      GVGJ(I) = FVGJ*GVGJ(I)
        GOTO 60
      ENDIF
C---- FOR FLOW AT AN ANGLE, CALCULATE HORIZONTIAL C0
      IF(IPAS.GT.1)THEN
C---- SECOND PASS - CALC WEIGHTED AVG OF C0 AND VGJ AND THEN VOID
        DO 40 I=1,2
        IF(I.EQ.2.AND.(XJF*XJG).GE.0.0)THEN
          GVOID(I) = 0.0
          GCZ(I)=0.0
          GVGJ(I)=0.0
        ELSE
          FR = 1.- ORT/90.
          IF(XJF.LT.0.0.AND.XJG.LT.0.0)THEN
            FR = 1.0
            IF(ORT.GE.80.)FR = 9. - ORT/10.
          ENDIF
          GCZ(I) = CZV(I)*FR + GCZ(I)*(1. - FR)
          GVGJ(I) = VJV(I)*FR + FVGJ*GVGJ(I)*(1. - FR)
          GVOID(I)=XJG/(GCZ(I)*(XJG+XJF)+GVGJ(I))
          IF(GVOID(I).GT.1.0.OR.GVOID(I).LT.0.0)GVOID(I)=1.0
        ENDIF
40      CONTINUE
      ELSE
C---- FIRST PASS - SAVE C0 AND VGJ AND SET FRA = 1.0 FOR HORIZONTIAL FLOW CALC
        IF(JF.LT.0.0.AND.JG.LT.0.0)THEN
          JF=DABS(JF)
          JG=DABS(JG)
          FVGJ=-1.0
        ENDIF
        DO 50 I=1,2
        CZV(I) = GCZ(I)
        VJV(I) = GVGJ(I)
50      CONTINUE 
        IPAS = 2
        FRA = 1.0
        GOTO 10
      ENDIF
60    CONTINUE
      VHEM=XJG/(XJG+XJF)
      DO 65 I=1,2
      IF(GVOID(I).GT.0.99.AND.GVOID(I).GT.VHEM)THEN
      GVOID(I)=VHEM
      GCZ(I)=1.0
      GVGJ(I)=0.0
      ENDIF
65    CONTINUE
66    CONTINUE
      RETURN
      END
CITERAT
      SUBROUTINE ITERAT(R1,IER)
C---- ITERAT USES THE REGULA-FALSI METHOD (SEE APPLIED NUMERICAL 
C---- METHODS BY CARNAHAN, LUTHER AND WILKES SECTION 3.8) TO SOLVE 
C---- THE EQUATION PRODUCTED BY THE POLY ROUTINE.
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JG,JF,KZ
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IR,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IR,IFL	!change by Yasu
      COMMON /POL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & I
      COMMON /GLENN/XJF,XJG,GVOID(2),GVGJ(2),GCZ(2),GQUAL(2)
      NP=1
      VOLD=-1.
      IF(R1*REG.LT.0.)NP=2
      ITER=20
      ZR=1.D-6
      DO 7 I=1,NP
      INDEX=I
      TOL=.01
      ZL=ZR
C---- COARSE OUTER LOOP TO ESTABLISH RANGE
77    CONTINUE
      IF(ZL.GT.0.94)TOL=.01*TOL/(DABS(TOL))
      IF(ZL.GT.0.985)TOL=.001*TOL/(DABS(TOL))
78    ZLL=ZL+TOL
      IF(ZLL.GE.1.0) ZLL=.9999999
      FF1=POLY(ZL)
      FF2=POLY(ZLL)
      IF(FF1*FF2.LT.0.)GOTO 3
      ZL=ZL+TOL
      IF(ZL.LE..001)GO TO 88
      IF(ZL.LT.(1.-.5*TOL))GO TO 77
      IF(I.EQ.1.AND.(R1*REG).LT.0.0)GO TO 88
C---- COULD NOT FIND THE SECOND ROOT - TOL IS REFINED AND KEEP TRYING
      VOLD=VOID
      ZL=.999
      TOL=-.01
      GO TO 77
C---- RANGE OF SOLUTION ESTABLISHED USE REGULA-FALSI TO FIND SOLUTION
3     ZR=ZL+TOL
      FZL=POLY(ZL)
      DO 6 J=1,ITER
      ZHALF=(ZL+ZR)/2.
      IF(ZHALF.GE.1.0)ZHALF=.9999999
      FZHALF=POLY(ZHALF)
      IF(FZHALF*FZL.LE.0.)GOTO 5
      ZL=ZHALF
      FZL=FZHALF
      GOTO 6
5     ZR=ZHALF
6     CONTINUE
      VOID=(ZL+ZR)/2.
C     WRITE(*,6666)VOID,R1,REG,JF,JG,CZ,VJ,C3(I),I
C6666 FORMAT(1X,F8.4,2F9.0,2F9.4,3F9.4,I5)
      GVOID(I)=VOID
      GVGJ(I)=VJ
      GCZ(I)=CZ
      GQUAL(I)=JG*RG/(JG*RG+JF*RF)
7     CONTINUE
      GOTO 100
88    CONTINUE
C---- NO SOLUTION FOUND
C     WRITE(*,6666)VOID,R1,REG,JF,JG,CZ,VJ,C3(I),I
      GVOID(I)=1.
      GVGJ(I)=1.0
      GCZ(I)=1.0
      GQUAL(I)=1.
      IF(I.EQ.1)IER=1
      IF(I.EQ.2.AND.IER.EQ.0)IER=2
      IF(I.EQ.2.AND.IER.EQ.1)IER=3
100   CONTINUE
      RETURN
      END
CPOLY
      FUNCTION POLY(ZL)
C---- POLY CALCULATES THE DIFFERENCE BETWEEN THE JG CALCULATED FROM 
C---- THE VOID FRACTION AND THE ACTUAL JG, THIS DIFFERENCE IS USED 
C---- BY THE ITERAT ROUTINE.
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JF,JG,KZ,L
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /POL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & INDEX
      AL=ZL
      DENOM=1.
      FJJ=JF+JG
C---- CALCULATE DRIFT FLUX VELOCITY
      VJJ=VJ0*C11*C2*C3(INDEX)
C---- DOUBLE CHECK THAT INPUT IS IN RANGE
      IF(AL.GE.1.0)AL=.999999
      IF(AL.LE.0.)AL=1.D-6
      ALM1=(1.-AL)
      ALTOR=ALM1**E1
      IF(JG.LT.0.0.AND.ALTOR.GT.0.7)ALTOR=0.7
      VJ=VJJ*ALTOR
C---- STEAM/WATER L FACTOR
      L=1.
      IF(C1.LT.170.)DENOM=1.-DEXP(-C1)
      IF(C1*AL.LT.170.)L=(1.-DEXP(-C1*AL))/DENOM
C---- AIR/WATER L FACTOR
      IF(TMP.GT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=1.15*(AL**0.45)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=1.05*AL**0.25
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=1.125*AL**0.6
         L=DMIN1(L,1.0d0)
      ENDIF
C---- REFRIGERANT L FACTOR
      IF(TMP.LT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=(AL**(.025*(1.+(10.*AL))))
         L=L*DEXP(0.5*ALM1)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=(1.-DEXP(-100.*AL))*
     &                  (0.2*AL+0.8-0.74*(AL**2)*ALM1)
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=AL*(1.375-1.5*((AL-0.5)**2))
      ENDIF
C---- CALCULATE CONCENTRATION PARAMETER
      CZ=L/(KZ+(1.-KZ)*(AL**R))
      IF(JG.LT.0.0)THEN
         CZA=-VJJ*(ALM1**0.2)/FJJ
         CZ=DMAX1(CZA,CZ)
      ENDIF
      IF(FRA.EQ.1.0)THEN
C---- CALCULATE HORIZONTIAL FLOW MULTIPLIER
         CZH=1.+(AL**.05)*ALM1**2
         CZ=CZ*CZH
      ENDIF
C---- CALCULATE VOID FRACTION AND ERROR BEFORE RETURNING
      AL=JG/(CZ*FJJ+VJ)
      POLY=ZL*(CZ*FJJ+VJ)-JG
66    CONTINUE
      RETURN
      END


c     the following lines have been copied from file 's22.f'     930825 chun


c$nofloatcalls
c$storage:2
CJTER
      SUBROUTINE JTER(VOIDIN,ANSWER)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JF,JG,KZ
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON/PIL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3,FRA
      NP=1
      VOLD=-1.
      ZR=1.0-1.D-6
      TOL=-.10
      ZL=ZR
      VRANGE=VOIDIN+.0005
C---- COARSE OUTER LOOP TO ESTABLISH RANGE
 77   CONTINUE
      IF(ZL.LT.(VOIDIN+.175))TOL=-0.01
      IF(ZL.LT.(VOIDIN+.0175))TOL=-0.001
      ZLL=ZL+TOL
      IF(ZLL.LT.VRANGE)ZLL=VRANGE
      IF(ZL.GE.1.0)ZL=.9999999
      IF(PALY(ZL)*PALY(ZLL).LT.0.)GO TO 3
      ZL=ZL+TOL
      IF(ZL.LE.VOIDIN)GO TO 88
      GO TO 77
3     VOID=(ZL+ZLL)/2.
 55   CONTINUE
      ANSWER=VOID
      RETURN
 88   CONTINUE
      ANSWER=-1.
      RETURN
      END
CPALY
      FUNCTION PALY(ZL)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JF,JG,KZ,L
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON/PIL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3,FRA
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
      COMMON /MODEL/DH,WF,WG,ORT
      AL=ZL
      DENOM=1.
      L=1.
      FJJ=JF+JG
C---- CALCULATE DRIFT FLUX VELOCITY
      VJJ=VJ0*C11*C2*C3
C---- DOUBLE CHECK THAT INPUT IS IN RANGE
      IF(AL.GE.1.0)AL=.999999
      IF(AL.LE.0.)AL=1.D-6
      ALM1=(1.-AL)
      ALTOR=ALM1**E1
      IF(JG.LT.0.0.AND.ALTOR.GT.0.7)ALTOR=0.7
      VJ=VJJ*ALTOR
C---- STEAM/WATER L FACTOR
      L=1.
      IF(C1.LT.170.)DENOM=1.-DEXP(-C1)
      IF(C1*AL.LT.170.)L=(1.-DEXP(-C1*AL))/DENOM
C---- AIR/WATER L FACTOR
      IF(TMP.GT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=1.15*(AL**0.45)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=1.05*AL**0.25
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=1.125*AL**0.6
         L=DMIN1(L,1.0d0)
      ENDIF
C---- REFRIGERANT L FACTOR
      IF(TMP.LT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=(AL**(.025*(1.+(10.*AL))))
         L=L*DEXP(0.5*ALM1)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=(1.-DEXP(-100.*AL))*
     &                  (0.2*AL+0.8-0.74*(AL**2)*ALM1)
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=AL*(1.375-1.5*((AL-0.5)**2))
      ENDIF
C---- CALCULATE CONCENTRATION PARAMETER
      CZ=L/(KZ+(1.-KZ)*(AL**R))
      IF(JG.LT.0.0)THEN
         CZA=-VJJ*(ALM1**0.2)/FJJ
         CZ=DMAX1(CZA,CZ)
      ENDIF
      IF(FRA.EQ.1.0)THEN
C---- CALCULATE HORIZONTIAL FLOW MULTIPLIER
         CZH=1.+(AL**.05)*ALM1**2
         CZ=CZ*CZH
      ENDIF
C---- CALCULATE VOID FRACTION AND ERROR BEFORE RETURNING
      AL=JG/(CZ*(FJJ)+VJ)
      PALY=ZL*(CZ*(FJJ)+VJ)-JG
      RETURN
      END
C
C     MAPGEN
C
      SUBROUTINE MAPGEN (ALPHA,XJF,TIMEX,TIMEY,TIMEJ)

      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION JFMAX,JGMAX ,MF,MG
cw    CHARACTER*8 PL(2),PL1(2),PL2(2),FLOW(4,2)
cw    CHARACTER*4 DIR(2)
      DIMENSION ALPHA(20),XJF(31)
      COMMON /CNTROL/PP,TT,DDH,PM,DHM,IOPT,IUNIT
      COMMON /MAP/ALMIN,ALMAX,DELAL,XMAX,YMAX,IMAP
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /MODEL/DH,WF,WG,ORT
cw    DATA PL/'MPascals','psia    ' /,PL1/'meters '  ,'feet    '/
cw    DATA PL2/'m/sec   ','ft/sec  '/
cw    DATA FLOW/'m/sec   ','kg/s-m2 ','kg/sec  ','m3/sec  ',
cw   1          'ft/sec  ','lb/s-ft2','lb/sec  ' ,'ft3/sec '/
cw    DATA DIR /'  Jf','  Jg'/

      J=IUNIT+1
      K=IMAP
      TIMEJ=1.0
      XDH=DDH
      XP=PP
      IF(IUNIT.EQ.0)THEN
            TIMEJ=1.0/3.2808
            XP=PM
            XDH=DHM
      ENDIF
C---- GENERATE VOID FRACTION INTERVALS
      N=1
      ALPHA(1)=ALMIN
1     CONTINUE
      N=N+1
      ALPHA(N)=ALPHA(N-1)+DELAL
      IF(ALPHA(N).GE.(ALMAX-1.0D-12))GO TO 2
      IF(N.EQ.19)GO TO 2
      GO TO 1
2     CONTINUE  
      IF(ALPHA(N).GE.ALMAX)ALPHA(N)=ALMAX
      IF(ALPHA(N).GE.0.995)ALPHA(N)=0.995
      ALPHA(N+1)=-1.
C GENERATE X INTERVALS AND CONVERT YMAX TO THE RIGHT UNITS --
C         COORDINATES OF MAP
C     1 - SUPERFICIAL VELOCITY VS SUPERFICIAL VELOCITY
C     2 - MASS VELOCITY VS MASS VELOCITY
C     3 - MASS FLOW RATE VS MASS FLOW RATE
C     4 - VOLUMETERIC FLOW RATE VS VOLUMETRIC FLOW RATE
      AREA=0.7854*DDH*DDH
      GO TO(10,20,30,40),IMAP
 10   CONTINUE
      JFMAX=XMAX
      JGMAX=YMAX
      TIMEX=1.0
      TIMEY=1.0
      IF(IUNIT.EQ.1) GO TO 50
      JFMAX=JFMAX*3.2808
      JGMAX=JGMAX*3.2808
      TIMEX=TIMEX/3.2808
      TIMEY=TIMEY/3.2808
      GO TO 50
20    CONTINUE
      JFMAX=XMAX/RF
      JGMAX=YMAX/RG
      TIMEX=RF
      TIMEY=RG
      IF(IUNIT.EQ.1)GO TO 50
      TIMEX=TIMEX/3.2808
      TIMEY=TIMEY/3.2808
      JFMAX=JFMAX*2.205*3.2808**2
      JGMAX=JGMAX*2.205*3.2808**2
      GO TO 50
30    CONTINUE
      JFMAX=XMAX/RF/AREA
      JGMAX=YMAX/RG/AREA
      TIMEX=RF*AREA
      TIMEY=RG*AREA
      IF(IUNIT.EQ.1)GO TO 50
      TIMEX=TIMEX/2.205
      TIMEY=TIMEY/2.205
      JFMAX=JFMAX*2.205
      JGMAX=JGMAX*2.205
      GO TO 50
40    CONTINUE
      JFMAX=XMAX/AREA
      JGMAX=YMAX/AREA
      TIMEX=AREA
      TIMEY=AREA
      IF(IUNIT.EQ.1)GO TO 50
      TIMEX=1./3.208**3
      TIMEY=1./3.208**3
      JFMAX=JFMAX*3.208**3
      JGMAX=JGMAX*3.208**3
50    CONTINUE
      IDEX=16
      IF(ORT.EQ.90.)IDEX=31
      DO 60 I=1,30
60    XJF(I)=JFMAX*2*((IDEX-I)/30.)
C---- WRITE HEADER FOR TAPE2
      XKEY=IMAP
      IF(IUNIT.EQ.1)XKEY=-IMAP

cDH   Add Calculation Type (=0) to output file
c
      WRITE(2,90) '0',XDH,XP,XKEY,XMAX,YMAX
 90   FORMAT(A1,5F12.3)
cw      WRITE(2,90)XDH,XP,XKEY,XMAX,YMAX
cw 90    FORMAT(5F12.3)
      RETURN
      END
C
C     NEWRAT
C
      SUBROUTINE NEWRAT(ALPHAM)

      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DOUBLE PRECISION MF,MG,JG,JF,KZ
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /POLL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & INDEX
      INDEX=1
      NP=1
      ITER=20
      ZR=1.D-6
      TOL=.05
      I=1
      ZL=ZR
      IDUM=I
77    CONTINUE
      IF(ZL.GT.0.85)TOL=0.01
      IF(ZL.GT.0.985)TOL=0.001
      IF(ZL.GT.0.9985)TOL=0.0001
      ZLL=ZL+TOL
      IF(ZLL.GE.1.0)ZLL=.9999999
      IF(POLLY(ZL)*POLLY(ZLL).LT.0.) GO TO 3
      ZL=ZL+TOL
      IF(ZL.LT.(1.-.5*TOL)) GO TO 77
      GO TO 88
C---- RANGE OF SOLUTION ESTABLISHED USE REGULA-FALSI TO FIND SOLUTION
3     ZR=ZL+TOL
      FZL=POLLY(ZL)
      DO 6 J=1,ITER
      ZHALF=(ZL+ZR)/2.
      IF(ZHALF.GE.1.0)ZHALF=.9999999
      FZHALF=POLLY(ZHALF)
      IF(FZHALF*FZL.LE.0.)GO TO 5
      ZL=ZHALF
      FZL=FZHALF
      GO TO 6
5     ZR=ZHALF
6     CONTINUE
      VOID=(ZL+ZR)/2.
      ALPHAM=VOID
C---- SOLUTION FOUND, VOID IS RETURNED IN ALPHAM
55    CONTINUE
      RETURN
88    CONTINUE
C---- NO SOLUTION FOUND, 10 IS RETURNED IN ALPHAM
      ALPHAM=10.0
      RETURN
      END

CFRESCO
      SUBROUTINE FRESCO(XJFIN,XJGIN,ICODE,ANSWER,VOID)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C---- ROUTINE TO CALCULATE A CCFL POINT USING THE CHEXAL-LELLOUCHE 
C---- CORRELATION, EPRI Report NSAC-139, Feb, 1991.
C---- THIS IS BASED ON FRESCO AS OF 8/1/86, MARCHING SOLUTION
C---- CALLING PARAMETERS -
C              XJFIN  - INPUT JF (FT/SEC)
C              XJGIN  - INPUT JG (FT/SEC)
C              ICODE  = -1  CCFL AT CONSTANT JF
C                     = +1  CCFL AT CONSTANT JG
C              ANSWER - JF OR JG STAR
C              VOID   - VOID FRACTION AT CCFL
      DOUBLE PRECISION MF,MG,JG,JF,KZ,JGOLD,JFOLD
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /POLL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & INDEX
      COMMON /MODEL/DH,WF,WG,ORT
      COMMON /FIL1/FJGSTAR,ALSTAR,CZSTAR,VGJSTAR
      VOID=0.0
      JG=XJGIN
      JF=-DABS(XJFIN)
      FPC=(PC-P)/PC
      C1=4.*PC/(P*FPC)
      RR=RF/RG
      VJ0=1.41*((RR-1.0)*SIG*32.17*32.17/(RR*RF))**0.25
      IF(RR.GE.18.)THEN
        C5=DSQRT(150./RR)
        C2=1.0
        IF(C5.LT.1.0)THEN
          ARG=C5/(1.-C5)
          IF(ARG.LT.170.)C2=1./(1.-DEXP(-ARG))
        ENDIF
      ELSE
        C2=0.4757*(DLOG(RR))**0.7
      ENDIF
      C11=1.
      C9=(0.3/DH)**.6
      IF(C9.GE.1.)GOTO 10
      C10=C9/(1.-C9)
      C11=1./(1.-DEXP(-C10))
10    CONTINUE
      NUM=80
C---- SET UP JF'S AND JG'S
      KEY=0
      DO 20 INUM =1,NUM
      CALL MARCH(ICODE,JF,JG,JFOLD,JGOLD,KEY,DELTA)
C     WRITE(*,66)ICODE,JF,JG,JFOLD,JGOLD,KEY,DELTA,VOID
C66   FORMAT(I5,4F10.4,I5,2F10.4)
      IF(DELTA.GT.1.D10) GO TO 30
      R1=RF*JF*DH*3600./MF
      REG=RG*JG*DH*3600./MG
      RE=REG
      B1=1.0
      IF(DABS(RE/60000.).LT.170.)B1= 1./(1.+DEXP(-RE/60000.))
      B1=DMIN1(0.8D0,B1)
      E1=B1
      IF(REG.LT.0.0)E1=0.65
      KZ=B1+(1.-B1)/(RR**0.25)
      R=(1.+1.57/RR)/(1.-B1)
      FIRST=2.*DEXP((-R1/350000.)**.400)
      POWER=-(R1/50000.)*((.125)/(DH))**2.0
      SEC=0.0
      IF(POWER.LT.170.)SEC=-(1.75*(-R1)**.030)*DEXP(-POWER)
      C3(1)=FIRST+SEC+1.0*((0.125/DH)**.250)*(-R1)**0.001
      POW2=(1.0/(1.0+0.05*(-R1/350000.)))**0.4
      C3(1)=2.0*((C3(1)/2.0)**POW2)
      CALL NEWRAT(ALPHAM)
      KEY=1
      IF(ALPHAM.LT.2.0)VOID=ALPHAM
      IF(ALPHAM.GE.2.0)KEY=2
20    CONTINUE
30    CONTINUE
      ANSWER=(JF+JFOLD)/2.
      IF(ICODE.LT.0)ANSWER=(JG+JGOLD)/2.
      CZSTAR=CZ
      VGJSTAR=VJ
      RETURN
      END
CMARCH
      SUBROUTINE MARCH(ICODE,JF,JG,JFOLD,JGOLD,KEY,DELTA)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION JF,JG,JGOLD,JFOLD
      K=KEY+1
      GOTO(10,20,30),K
10    CONTINUE
      DELTA=JG*16.
      IF(ICODE.GT.0) DELTA = DABS(JF)*16.
      IF(DELTA.GT.10000.)DELTA=1.0
      IF(DELTA.LT.1.0)DELTA=1.0
      JFOLD=JF
      JGOLD=JG
      RETURN
20    CONTINUE
C---- MARCH AHEAD
      IF(ICODE.LT.0) THEN
      JGOLD=JG
      JG=JG+DELTA
      ELSE
      JFOLD=JF
      JF=JF-DELTA
      ENDIF
      RETURN
30    CONTINUE
C---- REDUCE THE INTERVAL  AND KEEP 'OLD' VALUE CONSTANT
      DELTA=DELTA/2.
      IF(ICODE.LT.0) THEN
      JG=JGOLD+DELTA
      IF(DELTA/JGOLD.LT. 0.0001) DELTA = 1.D12
      ELSE
      JF=JFOLD-DELTA
      IF(-DELTA/JFOLD.LT. 0.0001) DELTA = 1.D12
      ENDIF
      RETURN
      END
CPOLLY 
      FUNCTION POLLY(ZL)
C
C**** POLLY CALCULATES THE DIFFERENCE BETWEEN THE
C**** JG CALCULATED FROM THE VOID FRACTION AND THE ACTUAL JG
C**** THIS DIFFERENCE IS USED IN THE ITERAT ROUTINE
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DOUBLE PRECISION MF,MG,JF,JG,KZ,L
c      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,IER,TSAT,IFL
      COMMON /PRO/MF,MG,P,PC,RF,RG,SIG,TMP,TSAT,IER,IFL	!change by Yasu
      COMMON /POLL/VJ,VJ0,CZ,C11,E1,C1,KZ,R,JG,JF,C2,C3(2),B1,REG,FRA,
     & INDEX
      AL=ZL
      DENOM=1.
      L=1.
      FJJ=JF+JG
C---- CALCULATE DRIFT FLUX VELOCITY
      VJJ=VJ0*C11*C2*C3(INDEX)
C---- DOUBLE CHECK THAT INPUT IS IN RANGE
      IF(AL.GE.1.0)AL=.999999
      IF(AL.LE.0.)AL=1.D-6
      ALM1=(1.-AL)
      ALTOR=ALM1**E1
      IF(JG.LT.0.0.AND.ALTOR.GT.0.7)ALTOR=0.7
      VJ=VJJ*ALTOR
C---- STEAM/WATER L FACTOR
      L=1.
      IF(C1.LT.170.)DENOM=1.-DEXP(-C1)
      IF(C1*AL.LT.170.)L=(1.-DEXP(-C1*AL))/DENOM
C---- AIR/WATER L FACTOR
      IF(TMP.GT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=1.15*(AL**0.45)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=1.05*AL**0.25
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=1.125*AL**0.6
         L=DMIN1(L,1.0d0)
      ENDIF
C---- REFRIGERANT L FACTOR
      IF(TMP.LT.0.0)THEN
C---- VERTICAL UP-FLOW
         L=(AL**(.025*(1.+(10.*AL))))
         L=L*DEXP(0.5*ALM1)
C---- VERTICAL DOWN-FLOW
         IF(JG.LT.0.0)L=(1.-DEXP(-100.*AL))*
     &                  (0.2*AL+0.8-0.74*(AL**2)*ALM1)
C---- HORIZONTIAL FLOW
         IF(FRA.EQ.1.0)L=AL*(1.375-1.5*((AL-0.5)**2))
      ENDIF
C---- CALCULATE CONCENTRATION PARAMETER
      CZ=L/(KZ+(1.-KZ)*(AL**R))
      IF(JG.LT.0.0)THEN
         CZA=-VJJ*(ALM1**0.2)/FJJ
         CZ=DMAX1(CZA,CZ)
      ENDIF
      IF(FRA.EQ.1.0)THEN
C---- CALCULATE HORIZONTIAL FLOW MULTIPLIER
         CZH=1.+(AL**.05)*ALM1**2
         CZ=CZ*CZH
      ENDIF
C---- CALCULATE VOID FRACTION AND ERROR BEFORE RETURNING
      AL=JG/(CZ*(FJJ)+VJ)
      POLLY=ZL*(CZ*(FJJ)+VJ)-JG
      RETURN
      END



c     the following lines have been copied from file 'hpt.f'     930825 chun


      FUNCTION HPT(P,T)
C****      SATURATED LIQUID OR SUPREHEATED ENTHALPY (BTU/LBM) AS A FUNCTION
C****      OF PRESSURE (LBF/IN2) AND TEMPERATURE (DEG F) - RETRAN02 PROP FIT
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      HF = HFP(P)
      HG = HGP(P)
      TS = TPHL(P,HF)
      IF(T.LT.TS)HGUES = T-32.D0
      IF(T.GT.TS)HGUES = HG+0.2*(T-TS)
      I=1
    1 CONTINUE
      IF(T.LT.TS)TCK = TPHL(P,HGUES)
      IF(T.GT.TS)TCK = TPHV(P,HGUES)
      IF(DABS((T-TCK)/T).LT.1D-2) GO TO 99
      IF(I.GT.1) GO TO 10
      IF(T.GT.TCK) HNEW=1.1*HGUES
      IF(T.LT.TCK) HNEW=0.9*HGUES
      GO TO 70
   10 HNEW=HGUES+(T-TCK)*(HGUES-HOLD)/(TCK-TOLD)
   70 CONTINUE
      TOOLD=TOLD
      HOOLD=HOLD
      TOLD=TCK
      HOLD=HGUES
      HGUES=HNEW
      I=I+1
      IF(I.GT.100) GO TO 80
      GO TO 1
   80 CONTINUE
      WRITE(0,101) I,P,T,HNEW
  101 FORMAT(1X,'DID NOT CONVERGE IN HPTL, I=',I4,
     $     2X,'P=',F7.2,2X,'T=',F7.2,2X,'H=',F8.2)
   99 CONTINUE
      HPT=HGUES
      RETURN
      END
CTPHV
      FUNCTION TPHV(P,H)
C****      SATURATED OR SUPERHEATED VAPOR TEMPERATURE (DEGF) AS
C****      A FUNCTION OF PRESSURE (LBF/IN2) AND ENTHALPY (BTU/LBM)
C****      - RETRAN02 PROP FIT
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION CT3(5,5),CT4(5,5)
      DATA CT3 / -.1179100862D5,.2829274345D2,-.267818
     11564D-1,.1218742752D-4,-.2092033147D-8,.1256160907D3,-.3333448495
     2D0,.3326901268D-3,-.1477890326D-6,.2463258371D-10,-.1083713369D0,
     3.292817773D-3,-.2972458D-6,.1342639113D-9,-.2275585718D-13,
     4.3278071846D-4,-.8970959364D-7,.9246248312D-10,-.4249155515D-13,
     5.7338316751D-17,-.3425564927D-8,.9527692453D-11,-.1001409043D-13,
     6.4703914404D-17,-.8315044742D-21/
      DATA CT4 / .3795256853D4,-.6347031007D1,
     1.2867228326D-2,.5953599813D-8,.4798207438D-10,-.3910086240D1,
     2.1222747819D-1,-.1404664699D-4,.7505679464D-8,-.1608693653D-11,
     3.3410500159D-4,.7010900113D-9,-.1030201866D-9,.5731099333D-14,
     4.3720795449D-16,.1527377542D-6,-.5356866315D-9,.6823225984D-12,
     5-.3668096142D-15,.6946004624D-19,-.1437179752D-10,.5006731336D-13,
     6-.6365519546D-16,.3473711350D-19,-.6842306083D-23/
      H1=1.0
      H2=H1*H
      H3=H2*H
      H4=H3*H
      H5=H4*H
      IF(P.GT.3208.2D0)GO TO 15
      TPHV=CT3(1,1)*H1+CT3(2,1)*H2+CT3(3,1)*H3+CT3(4,1)*H4+CT3(5,1)*H5
      TPHV=TPHV+(CT3(1,2)*H1+CT3(2,2)*H2+CT3(3,2)*H3+CT3(4,2)*H4+CT3(
     15,2)*H5)*P
      DO 10 J=3,5
      TPHV=TPHV+(CT3(1,J)*H1+CT3(2,J)*H2+CT3(3,J)*H3+CT3(4,J)*H4+CT3(5
     1,J)*H5)*P**(J-1)
   10 CONTINUE
      RETURN
   15 CONTINUE
      TPHV=CT4(1,1)*H1+CT4(2,1)*H2+CT4(3,1)*H3+CT4(4,1)*H4+CT4(5,1)*H5
      TPHV=TPHV+(CT4(1,2)*H1+CT4(2,2)*H2+CT4(3,2)*H3+CT4(4,2)*H4+CT4(
     15,2)*H5)*P
      DO 20 J=3,5
      TPHV=TPHV+(CT4(1,J)*H1+CT4(2,J)*H2+CT4(3,J)*H3+CT4(4,J)*H4+CT4(5
     1,J)*H5)*P**(J-1)
   20 CONTINUE
      RETURN
      END
