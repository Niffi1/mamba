#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

i=0
film=0.001

#temperature=(622.8123082242514 624.6395717844929 626.2733325585543 628.3846456164509 630.5670928899612 633.1464070838682 636.6722222222222 638.8621839034263)  #rod80

#temperature=(618.4609512390089 621.5107780442313 625.0439515054622 630.8728883559819 634.2589794830801 638.9661470823341 642.5813882227551 645.4745403677058 649.0881827871037 655.7116839861444) #rod86

#temperature=(620.8388888888890 621.5648148148148 623.1203703703703 624.6759259259258 626.1277777777777 630.7944444444445 635.0462962962963 636.8092592592592 639.4018518518517 641.7870370370370 644.5870370370369 646.6611111111110 649.1499999999999) #rod88-TC1

#temperature=(630.0550458499249 630.9917520667839 634.2524531899554 635.4207672198304 637.7513313659302 642.7673670486931 644.5168061366806 646.4978530376839 648.0151789865179 650.5822357649627 654.1966651843766) #rod90-TC2

#temperature=(631.445985060691 634.130392156863 633.896965452848 636.931512605042 640.549626517274 642.066900093371 643.467460317460 644.517880485528 646.968860877684 648.135994397759 649.303127917834)
#rod91-TC1

temperature=(626.007142857143 630.239947089947 631.562698412698 632.620899470900 637.118253968254 638.705555555556 640.292857142857 641.351058201058 642.673809523810 643.996560846561 644.261111111111 646.112962962963 649.287566137566)
#rod116-T3

#for heatflux in 0.473188611204391e6 0.630918148272522e6 0.788647685340652e6 0.946377222408782e6 1.104106759476913e6 1.261836296545042e6 1.419565833613173e6 1.577295370681304e6; #rod80

#for heatflux in 0.086459153652160e6 0.315459074136261e6 0.560816131797797e6 0.883285407581530e6 1.009469037236035e6 1.144999602420502e6 1.224448554425190e6 1.292213837017423e6 1.364652587374639e6 1.490836217029144e6  #rod86

#for heatflux in 0.334871940236954e6 0.440256070497859e6 0.559506533687830e6 0.695396596392680e6 0.789687660310333e6 1.011548987175394e6 1.141892516708619e6 1.216770714525576e6 1.291648912342536e6 1.358207310402055e6 1.433085508219013e6 1.494097373106906e6 1.555109237994798e6 #rod88-TC1

#for heatflux in  450329.258006112 497190.932062585 540623.703139317 581770.538896220 622917.374653124 747500.849583748 788647.685340652 824079.682797986 867512.453874717 936090.513469556 1013812.31434371
#rod90-TC2

#for heatflux in 0.717783690425985e6 0.784075814700996e6 0.852653874295836e6 0.980666252206201e6 1.170398883751923e6 1.241262878666592e6 1.307555002941602e6 1.369275256576959e6 1.488143893208012e6 1.549864146843368e6 1.607012529839067e6
#rod91-TC1

for heatflux in 469114.416519975 599488.646421308 660019.538875498 732190.987570879 836955.993741592 946377.222408782 999923.781118259 1067439.00731716 1104688.78728897 1167547.79099140 1218766.23845264 1265328.46341740 1386390.24832578
do
  echo heatflux $heatflux
  temp=${temperature[i]}
  echo temperature $temp
#This is for heat flux 1e6, 0.025 mm thickness, h=13000~1.5e4

  ~/Projects/mamba-dev/mamba-dev-opt -i subsub_5th.i Mesh/ymax=$film Mesh/xmin=0.004 Mesh/xmax=0.0236313 Materials/material_CRUD/CladHeatFluxIn=$heatflux Postprocessors/vapor_height=thickness=$film AuxKernels/aux_porosity/value=0.57
#0.002 0.0182091 0.5825 rod80
#0.0025 0.0098213 0.63  rod86
#0.002 0.0141 0.65  rod88-TC1
#0.0025 0.0182091 0.62 rod90-T2
#0.0015 0.0156478 0.26 rod1-T3
  python MyScript_Peak_Temp.py > temp.txt
  peak=$(cat $SCRIPT_DIR/temp.txt)
  rm temp.txt
  echo heatflux temperature film > ${heatflux}_${temp}_116_TC3.txt
  while ([ $( echo "$peak-$temp >= 0.3" | bc) -eq 1 ] || [ $( echo "$peak-$temp <= -0.3" | bc) -eq 1 ]) && [ $( echo "$film <= 0.025" | bc) -eq 1 ];
  do
    if [ $( echo "$peak-$temp >= 0.3" | bc) -eq 1 ]; then
      film=$(echo "$film-0.0002" | bc -l)
    else
      film=$(echo "$film+0.0005" | bc -l)
    fi
  ~/Projects/mamba-dev/mamba-dev-opt -i subsub_5th.i Mesh/ymax=$film Mesh/xmin=0.004 Mesh/xmax=0.0236313 Materials/material_CRUD/CladHeatFluxIn=$heatflux Postprocessors/vapor_height=thickness=$film AuxKernels/aux_porosity/value=0.57
    python MyScript_Peak_Temp.py > temp.txt
    peak=$(cat $SCRIPT_DIR/temp.txt)
    rm temp.txt
    echo iteration number $i
    echo heatflux $heatflux
    echo temperature $temp
    echo film $film
    echo $heatflux $temp $film >> ${heatflux}_${temp}_116_TC3.txt
  done
  cp subsub_5th.csv subsub_${heatflux}_${temp}_${film}_116_TC3.csv

  i=$((i+1))
done

